#!/usr/bin/perl

#   This program is free software; you can redistribute it and/or modify
#   it under the terms of the GNU General Public License as published by
#   the Free Software Foundation; either version 2 of the License, or
#   (at your option) any later version.
 
#   This program is distributed in the hope that it will be useful,
#   but WITHOUT ANY WARRANTY; without even the implied warranty of
#   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#   GNU General Public License for more details.
 
#   You should have received a copy of the GNU General Public License
#   along with this program; if not, write to the Free Software
#   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA

#   Sean Dague <japh@us.ibm.com
#
#   This is the oscar installation program.  It must be called with one arguement
#   which is the installation network device

use strict;
use vars qw($VERSION);
use Cwd qw(chdir cwd);
use Carp;

# Setting this varible makes a lot of things much easier.  It might also do
# us some good down the road
$ENV{OSCAR_HOME} = cwd();

# add entries to path that we know we will need
$ENV{PATH} = $ENV{PATH} . ':/bin:/usr/bin:/sbin:/usr/sbin:/usr/local/bin:/usr/local/sbin';

my $adapter = shift or croak("Program must be invoked as ./install_cluster <network device>");

system("chmod 755 packages/*/scripts/*");

chdir("scripts") or croak("Couldn't chdir to scripts");

#Check for 2 rpms 1 from each cd
my @basesystem=glob("/tftpboot/rpm/basesystem*rpm");
my @rsync=glob("/tftpboot/rpm/rsync*rpm");
if ((scalar(@basesystem)==0) || (scalar(@rsync)==0)) {
	croak("RPMs missing in /tftpboot/rpm/ (did you copy both CDs?)");
}

# Big difference here, we are only going to change what we have to get
# to the OSCAR wizard.  All the rest of server prep is going to be
# driven after the first panel of questions.

!system("./wizard_prep $adapter 2>&1 ") or croak("Oscar Wizard preparation script failed to complete");

!system("./oscar_wizard $adapter 2>&1 | tee -a ../oscarinstall.log") or croak("Oscar Wizard failed to run successfully");


