#!/bin/sh
#
# $Id: post_clients,v 1.2 2002/10/29 18:34:48 jsquyres Exp $
#
# post_clients script for the switcher package
#
# Setup the switcher.ini file on the head node to be syncronized
# across the cluster.
#

# The first time through the installation, the siwtcher config file
# will not exist yet (we don't set the tag/name defaults until later).
# So touch it so that sync_users won't complain that it doesn't exist.

sw_file=/opt/env-switcher/etc/switcher.ini
if (! -f $sw_file) then
    touch $sw_file
    chmod 644 $sw_file
fi

# Add /opt/switcher/etc/switcher.ini to /opt/opium/etc/opium.conf.
# This script may be re-run, so ensure that it is only listed in the
# file once.

op_file=/opt/opium/etc/sync_users.conf
ret=0

if test ! -f $op_file; then
    cat <<EOF
***********************************************************************
OSCAR package: switcher
API call: post_clients
Error: OPIUM config file ($op_file) does not exist
***********************************************************************
EOF
    ret=1
elif test "`grep $sw_file $op_file`" = ""; then
    echo "syncfile $sw_file" >> $op_file
fi

# All done

exit $ret
