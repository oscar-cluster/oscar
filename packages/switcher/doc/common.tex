% -*- latex -*-
%
% $Id: common.tex,v 1.5 2002/07/20 17:24:05 jsquyres Exp $
%
% $COPYRIGHT$
%

Starting with the OSCAR 1.3 series, there is a generalized mechanism
to both set a system-level default MPI implementation, and also to
allow users to override the system-level default with their own choice
of MPI implementation.

This allows multiple MPI implementations to be installed on an OSCAR
cluster (e.g., LAM/MPI and MPICH), yet still provide unambiguous MPI
implementation selection such that ``\cmd{mpicc foo.c -o foo}'' will
give deterministic results.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsubsection{Setting the system-level default}

The system-level default MPI implementation can be set in two ways:

\begin{enumerate}
\item During the OSCAR installation, the GUI will prompt asking which
  MPI should be the system-level default.  This will set the default
  for all users on the system who do not provide their own individual
  MPI settings.
  
\item As \user{root}, execute the command:

\begin{verbatim}
  # switcher mpi --list
\end{verbatim}

   This will list all the MPI implementations available.  To set the
   system-level default, execute the command:

\begin{verbatim}
  # switcher mpi = name --system
\end{verbatim}
   
   where ``name'' is one of the names from the output of the
   \cmd{--list} command.
\end{enumerate}

{\bf NOTE:} The current version of \cmd{switcher} is not
``cluster-aware.''  Hence, if you set the system-level default on one
machine in your cluster, it does {\em not} set the system-level
default on all nodes.  In order to propogate the change in any
\cmd{switcher} system-default settings, you must manually execute the
following command:

\begin{verbatim}
  # cpush /opt/env-switcher-1.0.4/etc/switcher.ini \
       /opt/env-switcher-1.0.4/etc/switcher.ini
\end{verbatim}

Similar to the workaround for the OPIUM package, it may be desirable
to install a \user{root} \cmd{cron} entry that automatically executes
this \cmd{cpush} at a low frequency (perhaps once an hour or once a
day).

The same is {\em not} true for user-level defaults.  Since user-level
defaults are stored in the home directory for each user, the fact that
user home directories are NFS-mounted on all nodes effectively takes
care of ensuring that \cmd{switcher}'s user-level defaults are
available everywhere.

{\bf NOTE:} Using the \cmd{switcher} command to change the default MPI
implementation will modify the \cmd{PATH} and \cmd{MANPATH} for all
{\em future} shell invocations -- it does {\em not} change the
environment of the shell in which it was invoked.  For example:

\begin{verbatim}
  $ which mpicc
  /opt/lam-1.2.3/bin/mpicc
  $ switcher mpi = mpich-4.5.6 --system
  $ which mpicc
  /opt/lam-1.2.3/bin/mpicc
  $ bash
  $ which mpicc
  /opt/mpich-4.5.6/bin/mpicc
\end{verbatim}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsubsection{Setting the user-level default}

Setting a user-level default is essentially the same as setting the
system-level default, except without the \cmd{--system} argument.
This will set the user-level default instead of the system-level
default:

\begin{verbatim}
  $ switcher mpi = lam-1.2.3
\end{verbatim}

Using the special name \cmd{none} will remove the user-level default
and revert the user to the system-level default:

\begin{verbatim}
  $ switcher mpi = none
\end{verbatim}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Use \cmd{switcher} with care!}

\cmd{switcher} immediately affects the environment of all future shell
invocations (including the environment of scripts).  To get a full
list of options available, read the \cmd{switcher(1)} man page, and/or
run \cmd{switcher --help}.

