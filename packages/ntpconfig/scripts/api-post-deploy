#!/usr/bin/env perl

# Copyright (C) 2006 Bernard Li <bli@bcgsc.ca>
#                    All rights reserved

# Post install action to restart ntpds.  This is necessary because when the
# node is booting for the first time, other nodes are sometimes building,
# causing network saturation.  This causes the ntpd to give up and try later.

use Carp;
use OSCAR::Opkg;
use OSCAR::SystemServices;
use OSCAR::SystemServicesDefs;

opkg_print("restarting ntp service\n");
!system_service(NTP(),RESTART())
    or croak "ERROR: Couldn't restart ntp service.";

opkg_print("restarting ntp service on all nodes\n");
!remote_system_service(NTP(),RESTART(),"/usr/bin/cexec")
    or croak "ERROR: Couldn't restart ntp service on all nodes.";
