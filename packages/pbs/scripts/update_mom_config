#!/bin/bash
# Updates mom config file with real PBS server hostname and pushes it out.
# 

. /etc/profile
mom_config=/var/spool/pbs/mom_priv/config

if [ -f $mom_config ] ; then
  cat $mom_config |sed s/pbs_oscar/$HOSTNAME/g > $mom_config
  echo "PBS mom config file updated with clienthost: $HOSTNAME"
  echo "Pushing config file to clients..."
  if [ -x `which cpush` ] ; then
    cpush $mom_config $mom_config
  else
    echo "Error:  Can't find cpush utility."
    exit 1
  fi
  echo "Sending SIGHUP to all moms..."
  if [ -x `which cexec` ] ; then
    cexec killall -1 pbs_mom
  else
    echo "Error:  Can't find cexec utility."
    exit 1
  fi
else
  echo "Error:  Not updating PBS mom config file."
  echo "$mom_config not found."
  exit 1
fi

