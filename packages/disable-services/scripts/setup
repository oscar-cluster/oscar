#!/bin/sh
#
# Copyright (c) 2002-2004 The Trustees of Indiana University.  
#                         All rights reserved.
# 
# This file is part of the OSCAR software package.  For license
# information, see the COPYING file in the top level directory of the
# OSCAR source distribution.
#
# $Id: setup 2587 2004-08-17 21:24:46Z dikim $
#

dir="$OSCAR_PACKAGE_HOME/scripts"


#
# Create a post_client_rpm_install script that consists of all the
# disable.* scripts and enable.client.mail-locally in this directory.
# This is necessary because post_client_rpm_install runs in the client
# filesystem, and the disable.* scripts and enable.client.mail-locally
# will not be there.  So paste them all together
# into a single post_client_rpm_install script to run later.
#

client_output="post_client_rpm_install"

rm -f $client_output

# Create a script that will exist on the client nodes.  Since we do
# not have access to ODA out there, do a few lookups now (snice we're
# running on the server) and put that information in the script that
# will run on the client.

# Create a script to disable a bunch of stuff on the clients.

client_files="`ls disable.*`"
for file in $client_files
do
  echo "# Contents of $file script:" >> $client_output
  cat $file >> $client_output
  echo "# End of $file script:" >> $client_output
done

# Add to that script commands to enable a bunch of stuff.

client_files="`ls enable.client.*`"
for file in $client_files
do
  echo "# Contents of $file script:" >> $client_output
  cat $file >> $client_output
  echo "# End of $file script:" >> $client_output
done

chmod +x $client_output

echo Created: $dir/$client_output


#
# This script checks to see if the MTA, which OSCAR does
# not support, exist such as sendmail and exim.
# If any MTA (sendmail or exim) except for postfix is installed
# it should be uninstalled since now OSCAR is supporting only postfix 
# for disable-services package.
#


# Check if sendmail, exim, or postfix is running. If so, kill it.
# No mailing service will run.

services="sendmail exim postfix"
for service in $services; do

    # See if this is the daemon installed

    chkconfig --list $service > /dev/null 2>&1
    if test "$?" = "0"; then

        #STOP the daemon
        /etc/init.d/$service stop

    fi
done

#
# All done
#

exit 0

