% -*- latex -*-
%
% $Id: install.tex,v 1.7 2002/07/17 13:37:19 jsquyres Exp $
%
% $COPYRIGHT$
%

\subsection{The OSCAR Password Installer and User Management (OPIUM)}
\label{app:opium-overview}

OPIUM is OSCAR's facility to manage user accounts on the cluster.
Currently, OPIUM does this by replicating files on a triggered basis.
The user account files are copied to each node each time certain
commands are invoked:

\begin{itemize}
\item \file{/etc/passwd}
\item \file{/etc/shadow}
\item \file{/etc/group}
\item \file{/etc/gshadow}
\end{itemize}

It is possible to add your own files to this list, by editing the
command script which does the work.  The command is
\cmd{/usr/sbin/sync\_users}.  It is triggered by wrapper scripts
around the user management commands in Linux.  The wrapped scripts:

\begin{itemize}
\item \cmd{/usr/sbin/useradd}
\item \cmd{/usr/sbin/userdel}
\item \cmd{/usr/sbin/usermod}
\item \cmd{/usr/sbin/groupadd}
\item \cmd{/usr/sbin/groupdel}
\item \cmd{/usr/sbin/groupmod}
\end{itemize}

\paragraph{Problems with \cmd{sync\_users}:}
\begin{itemize}
\item \cmd{chsh} and \cmd{passwd} commands don't trigger a sync.  It
  is strongly recomended that system administrators install a
  \user{root} \cmd{cron} entry similar to the following:

\begin{verbatim}
  0 * * * * /usr/sbin/sync_users > /dev/null 2>&1
\end{verbatim}

  This will automatically run the \cmd{sync\_users} script every
  hour.  In this way, users can change their passwords and shells on
  the server node and have them automatically propogate out to the
  client nodes every hour.
  
\item If the shadow utils RPMs are updated (\cmd{useradd},
  \cmd{userdel}, etc), the wrapped scripts are blown away, thus
  removing the \cmd{sync\_users} triggers.
  
\item The ``-c'' option on \cmd{useradd} (used for comments) doesn't
  work due to the wrapped script not handling quotation marks
  properly.
\end{itemize}

These issues will all be fixed in the next version of OSCAR.  The
shadow utils commands will no longer be wrapped, and a cron job will
be watching a given list of files to synchronize with the client nodes
when they change on the server node.

\paragraph{SSH Configuration}

The OPIUM package also handles the SSH key setup.  This is done by
placing startup scripts in \file{/etc/profile.d} which generate SSH
user key files if they don't exist.  It also generates
\file{authorized\_keys} files which enable users to traverse the
cluster securely without entering passwords.  Since these files reside
in the users' home directories, it is necessary for the home directory
to be mounted on a node in order for a user to \cmd{ssh} to it.  Also,
a user must log on to the head node in order for the keys to be
generated, as the \file{/etc/profile.d} scripts are not installed on
the compute nodes in OSCAR \oscarversion.  SSH1 and SSH2 key files are
supported.

