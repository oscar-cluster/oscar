#!/usr/bin/perl
# $Id: post_server_rpm_uninstall,v 1.1 2003/11/05 21:56:44 naughtont Exp $
#
# This file is part of the OSCAR software package.  For license
# information, see the COPYING file in the top level directory of the
# OSCAR source distribution.
#
# server uninstall script
# Must exit with 0 on success or non-zero for any failures.

use lib "$ENV{OSCAR_HOME}/lib";
use OSCAR::Distro;   # Run on server so have access to libs

my ($distro, $ver) = which_distro_server();

if( ($distro eq "mandrake") && ($ver eq "9.2") ) {
	my @rpms = qw(apache
			apache-conf
			apache-modules
			dhcp-common
			dhcp-server
			expat
			libpcap0
			librrdtool0
			locales
			locales-en
			lynx
			mod_php
			php-ini
			libphp_common432
			libmm1
			openssh
			openssh-clients
			openssh-server
			openssl
			perl-devel
			perl-CGI
			perl-XML-Parser
			libpwlib1
			nfs-utils
			nfs-utils-clients
			php-xml
			python
			python2-compat
			rrdtool
			tcsh
			tcpdump
			xinetd
			zlib1
			zlib1-devel
			postgresql
			libpgtcl2
			libecpg3
			sfio
			libgmp3
			);
	remove_rpms(@rpms);

}
elsif( ($distro eq "mandrake") && ($ver eq "9.0") ) {
	my @rpms = qw(apache
			apache-common
			apache-conf
			apache-modules
			dhcp-common
			dhcp-server
			expat
			libpcap0
			librrdtool0
			locales
			locales-en
			lynx
			mod_php
			libmm1
			openssh
			openssh-clients
			openssh-server
			openssl
			perl-devel
			perl-CGI
			perl-XML-Parser
			pwlib1
			nfs-utils
			nfs-utils-clients
			php
			php-common
			php-xml
			python
			python2-compat
			rrdtool
			tcsh
			tcpdump
			xinetd
			zlib1
			zlib1-devel
			postgresql
			libpgsql2
			libpgperl
			libpgtcl2
			libecpg3
			libpgsqlodbc0
			sfio
			libgmp3
			);
	remove_rpms(@rpms);

}
elsif( (($distro eq "redhat") && ($ver eq "7.3")) ||
       (($distro eq "rhas")   && ($ver eq "2.1AS")) 
     ) {
	my @rpms = qw(dhcp
			gd
			mm
			nfs-utils
			openssh
			openssh-clients
			openssh-server
			openssl
			tcpdump
			xinetd
			apache
			php
			expat
			python2
			zlib
			zlib-devel
			shadow-utils
			libcap
			);
	remove_rpms(@rpms);

}
elsif( ($distro eq "redhat") && ($ver eq "8.0") ) {
	my @rpms = qw(dhcp
			gd
			nfs-utils
			openssh
			openssh-clients
			openssh-server
			openssl
			tcpdump
			xinetd
			httpd
			php
			expat
			python
			zlib
			zlib-devel
			shadow-utils
			libcap
			);
	remove_rpms(@rpms);

}
elsif( ($distro eq "redhat") && ($ver eq "9") ) {
	my @rpms = qw(dhcp
			gd
			nfs-utils
			openssh
			openssh-clients
			openssh-server
			openssl
			tcpdump
			xinetd
			httpd
			php
			expat
			python
			zlib
			zlib-devel
			shadow-utils
			libcap
			);
	remove_rpms(@rpms);

}
elsif( ($distro eq "redhat") && ($ver eq "9") ) {
	my @rpms = qw(dhcp-server
			dhcp-base
			python
			gd
			mm
			nfs-utils
			openssh
			openssl
			tcpdump
			xinetd
			apache
			mod_php4
			mod_php4-core
			libmcrypt
			gmp
			t1lib
			ucdsnmp
			libiodbc
			libmcal
			sablot
			perl-SNMP
			imap-lib
			postgresql-libs
			expat
			zlib
			zlib-devel
			shadow
			libcap
			python2-compat
			perl-HTML-Tagset
			perl-HTML-Parser
			perl-libwww-perl
			perl-URI
			freetype2-devel
			libmng-devel
			mesaglut-devel
			libpng-devel
			);
	remove_rpms(@rpms);
}

#-------------------------------------------------------------
#  Input: Array of rpms to remove (short name no version)
# Output: n/a
# Return: 0 (success) otherwise die's  :)
#-------------------------------------------------------------
sub remove_rpms
{
	my @rpms = @_;
	my $cmd = "rpm -e " . join(" ", @rpms);

	my $rc = system($cmd);
	die "Error: command ($cmd)\n" if($rc);

	return(0);
}

#-------------------------------------------------------------
#  Input: Array of fully qualified files to remove
# Output: n/a
# Return: 0 (success) otherwise die's  :)
#-------------------------------------------------------------
sub remove_files
{
    my @files = @_;
    my $rc = 0; 

    foreach my $f (@files) {
        $rc = system("rm -f $f") or die "Error: calling system(): $!\n";
		print "DBG: system( rm -f $f )\n";
        die "Error: command ($cmd)\n" if($rc);
    }
    return(0);
}   

