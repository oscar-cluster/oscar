#!/usr/bin/perl
# $Id: post_clients,v 1.5 2003/12/04 21:20:04 brechin Exp $
#
# gen_c3_conf - script to generate the /etc/c3.conf file from the ORNL
#               cluster definition file
# Author: Brian Leuthke
# Last Updated: 10/10/2000, 5/15/2002


use strict;
use Carp;
use lib '/usr/lib/systeminstaller';
use SystemInstaller::Machine;
use Data::Dumper;

my $image = shift;

my %hash = get_machine_listing($image);
my @hosts = sort numerically keys %hash;
my $c3mgr = "$ENV{OSCAR_HOME}/scripts/c3_conf_manager";

!system("$c3mgr --rm oscar_cluster && $c3mgr --add oscar_cluster " . join(' ', @hosts)) or 
	Carp("I couldn't manage to update the C3 configuration!\n");

# Sort hostnames numerically instead of an ascii sort.
# Special sort() sub-rtn (uses $a, $b instead of @_)
sub numerically
{
	$a =~ /(\d+)$/;	 # pickoff number and
	my $A = $1;	     #  save in local var

	$b =~ /(\d+)$/;	 # pickoff number and
	my $B = $1;	     #  save in local var

	($A <=> $B)
}
