<?xml version="1.0" encoding="ISO-8859-1"?>

<oscar>
  <!--
      Copyright (c) 2003 NCSA 
                         All rights reserved.
      
      This file is part of the OSCAR software package.  For license
      information, see the COPYING file in the top level directory of the
      OSCAR source distribution.
     
      $Id: config.xml,v 1.30 2003/04/10 21:19:41 ngorsuch Exp $
  -->
  <name>oda</name>

  <!--
  =====================================================
  =====================================================
  ==                                                 ==
  ==    oda data for oda record in packages table    ==
  ==                                                 ==
  =====================================================
  =====================================================
  -->

  <version>
    <major>1</major>
    <minor>11</minor>
    <subversion>0</subversion>
    <release>1</release>
    <epoch>1</epoch>
  </version>

  <class>core</class>
  <installable>1</installable>

  <summary>Oscar DAtabase</summary>
  <license>Freely distributable</license>
  <group>Application/Environment</group>

  <packager>
    <name>Neil Gorsuch</name>
    <email>ngorsuch@ncsa.uiuc.edu</email>
  </packager>

  <description>ODA provides a central database for OSCAR.</description>

  <rpmlist>
    <all>
      <rpm>mysql</rpm>
      <rpm>perl-DBD-MySQL</rpm>
      <rpm>perl-DBI</rpm>
      <rpm>oda</rpm>
    </all>
    <server>
      <rpm>mysql-server</rpm>
    </server>
  </rpmlist>

  <package>
    <oda>
        <!--
        ===============================================
        ===============================================
        ==                                           ==
        ==        global shortcut definitions        ==
        ==                                           ==
        ===============================================
        ===============================================
	 -->

        <!--

	add_dns_server_to_node adds a dns server to a
	node record, required and only parameters are:

	dns_server    IP or dns name of dns server machine to add
	node          cluster node name of the record to modify

	 -->
	<shortcut> add_dns_server_to_node insert_record node_dns_server_entries node_dns_server_entries.server~%1 nodes.name=%2 node_dns_server_entries.node_id~nodes.id </shortcut>
        <!--

	add_node_to_node_group adds a compute node to a
	node group, required and only parameters are:

	node          name of the cluster node to add to group
	node_group    name of the node group to add it to

	 -->
	<shortcut> add_node_to_node_group insert_record node_group_node_entries nodes.name=%1 node_groups.name=%2 node_group_node_entries.included_node_id~nodes.id node_group_node_entries.node_group_id~node_groups.id </shortcut>
        <!--

	add_package_set_to_node adds a software package set to a
	compute node record, required and only parameters are:

	set           name of the package set to add to the node
	node          name of the compute node record to add it to

	 -->
	<shortcut> add_package_set_to_node insert_record node_package_set_entries package_sets.name=%1 nodes.name=%2 node_package_set_entries.node_id~nodes.id node_package_set_entries.package_set_id~package_sets.id </shortcut>
        <!--

	add_package_to_package_set adds a software package set to
	a package set record, required and only parameters are:

	package       name of the package to add to the package set
	set           name of the package set record to add it to

	 -->
	<shortcut> add_package_to_package_set insert_record package_set_package_entries packages.name=%1 package_sets.name=%2 package_set_package_entries.included_package_id~packages.id package_set_package_entries.package_set_id~package_sets.id </shortcut>
        <!--

	add_partition_to_disk_layout adds a disk partition to a
	disk layout record, required and only parameters are:

	name          partition name
	offset        offset of the start of the partition
	size          size of the partition
	type          type of the partition
	layout	      name of the disk layout record to add it to

	 -->
	<shortcut> add_partition_to_disk_layout insert_record disk_partition_entries partition~%1 offset~%2 size~%3 type~%4 disk_layouts.name=%5 disk_layout_id~disk_layouts.id </shortcut>
        <!--

	create_disk_layout creates a new disk layout record,
	required parameters are:

	name          name of the new disk layout record

	Optional parameters are:

	units         for offsets and sizes (default mb)

	 -->
	<shortcut> create_disk_layout insert_record disk_partition_entries disk_partition_entries.name~%1 %+ </shortcut>
        <!--

	create_image creates a new image record,
	required parameters are:

	name          name of the new image record

	Optional parameters are:

	path          base directory path on server

	 -->
	<shortcut> create_image insert_record images images.name~%1 %+ </shortcut>
        <!--

	create_network creates a new network record,
	required parameters are:

	name          name of the new network record

	Optional parameters are:

	cluster_only  non-zero if private cluster network

	 -->
	<shortcut> create_network insert_record networks networks.name~%1 %+ </shortcut>
        <!--

	create_nic_on_node creates a new network interface entry
	in a node record, required parameters are:

	nic name      name of the new network interface entry
	node name     name of the node record

	Optional parameters are:

        assignment    method of assigning IP "static" or "dhcp"
        broadcast     broadcast address of the network
        driver_module name of the associated driver module
        interface     name of the interface
        ip            ip address of the nic
        mac	      mac address of the nic
        netmask	      netmask mask of the network

	 -->
	<shortcut> create_nic_on_node insert_record nics nics.name~%1 nodes.name=%2 nics.node_id~nodes.id %+ </shortcut>
        <!--

	create_node creates a new node record,
	 required parameters are:

	name          name of the node record

	Optional parameters are:

	cpu_num       number of processors
	cpu_speed     speed of processor(s)
	cpu_type      type of processor(s)
	default_gateway IP or dns name of the default gateway
	domain        dns domain of the node
	hostname      name of the node returned by hostname command
	ram           amount of ram in the node
	swap	      amount of swap space in the node
	units	      units for ram and swap

	 -->
	<shortcut> create_node insert_record nodes nodes.name~%1 %+ </shortcut>
        <!--

	create_node_group creates a new node group record,
	required parameters are:

	name          name of the node group

	 -->
	<shortcut> create_node_group insert_record node_groups node_groups.name~%1 %+ </shortcut>
        <!--

	create_package_set creates a new software package set record,
	required parameters are:

	name          name of the package set

	 -->
	<shortcut> create_package_set insert_record package_sets package_sets.name~%1 %+ </shortcut>
        <!--

	delete_package_set deletes a software package set record,
	required parameters are:

	name          name of the package set

	 -->
	<shortcut> delete_all_package_sets delete_records package_sets </shortcut>
	<shortcut> delete_disk_layout delete_records disk_partition_entries disk_partition_entries.name=%1 </shortcut>
	<shortcut> delete_image delete_records images images.name=%1 </shortcut>
	<shortcut> delete_network delete_records networks networks.name=%1 </shortcut>
	<shortcut> delete_nic_from_node delete_records nics nics.name=%1 nodes.name=%2 nics.node_id=nodes.id </shortcut>
	<shortcut> delete_node delete_records nodes nodes.name=%1 </shortcut>
	<shortcut> delete_node_group delete_records node_groups node_groups.name=%1 </shortcut>
	<shortcut> delete_package_set delete_records package_sets package_sets.name=%1 </shortcut>
	<shortcut> disk_layout_id_to_name read_records disk_layouts.name disk_layouts.id=%1 </shortcut>
	<shortcut> disk_layout_name_to_id read_records disk_layouts.id disk_layouts.name=%1 </shortcut>
	<shortcut> disk_layouts read_records|modify_records disk_layouts.name %+ </shortcut>
	<shortcut> image_id_to_name read_records images.name images.id=%1 </shortcut>
	<shortcut> image_name_to_id read_records images.id images.name=%1 </shortcut>
	<shortcut> images read_records|modify_records images.name %+ </shortcut>
	<shortcut> link_node_nic_to_network modify_records nics nodes.name=%1 nics.name=%2 networks.name=%3 nics.node_id~nodes.id nics.network_id~networks.id </shortcut>
	<shortcut> link_node_to_disk_layout modify_records modes nodes.name=%1 disk_layouts.name=%2 nodes.disk_layout_id~disk_layouts.id </shortcut>
	<shortcut> link_node_to_image modify_records nodes nodes.name=%1 images.name=%2 nodes.image_id~images.id </shortcut>
	<shortcut> list_nics_on_node read_records nodes.name=%1 nics.node_id=nodes.id nics.name </shortcut>
	<shortcut> list_node_nics_on_network read_records networks.name=%1 nics.node_id=nodes.id nics.network_id=networks.id nodes.name nics.name </shortcut>
	<shortcut> list_nodes_in_disk_layout read_records disk_layouts.name=%1 disk_layouts.id=nodes.disk_layout_id nodes.name </shortcut>
	<shortcut> list_nodes_in_image read_records images.name=%1 images.id=nodes.image_id nodes.name </shortcut>
	<shortcut> list_nodes_on_network read_records networks.name=%1 nics.node_id=nodes.id nics.network_id=networks.id nodes.name </shortcut>
	<shortcut> list_nodes_using_dns_server read_records node_dns_server_entries.server=%1 node_dns_server_entries.node_id=nodes.id nodes.name </shortcut>
	<shortcut> list_packages_in_package_set read_records package_sets.name=%1 package_sets.id=package_set_package_entries.package_set_id package_set_package_entries.included_package_id=packages.id packages.name </shortcut>
	<shortcut> network_id_to_name read_records networks.name networks.id=%1 </shortcut>
	<shortcut> network_name_to_id read_records networks.id networks.name=%1 </shortcut>
	<shortcut> networks read_records|modify_records networks.name %+ </shortcut>
	<shortcut> nics read_records|modify_records nics.name %+ </shortcut>
	<shortcut> node_cluster_only_ips read_records nodes.name=%1 nics.node_id=nodes.id nics.network_id=networks.id networks.cluster_only!=0 nics.ip </shortcut>
	<shortcut> node_group_id_to_name read_records node_groups.name node_groups.id=%1 </shortcut>
	<shortcut> node_group_name_to_id read_records node_groups.id node_groups.name=%1 </shortcut>
	<shortcut> node_groups read_records|modify_records node_groups node_groups.name %+ </shortcut>
	<shortcut> node_id_to_name read_records nodes.name nodes.id=%1 </shortcut>
	<shortcut> node_ips read_records nodes.name=%1 nics.node_id=nodes.id nics.network_id=networks.id nics.ip </shortcut>
	<shortcut> node_name_to_id read_records nodes.id nodes.name=%1 </shortcut>
	<shortcut> node_public_ips read_records nodes.name=%1 nics.node_id=nodes.id nics.network_id=networks.id networks.cluster_only=0 nics.ip </shortcut>
	<shortcut> nodes read_records|modify_records nodes name %+ </shortcut>
	<shortcut> nodes_cluster_only_ips read_records nics.node_id=nodes.id nics.network_id=networks.id networks.cluster_only!=0 nics.ip </shortcut>
	<shortcut> nodes_public_ips read_records nics.node_id=nodes.id nics.network_id=networks.id networks.cluster_only=0 nics.ip </shortcut>
	<shortcut> oscar_server read_records oscar.oscar_server_id!=undef oscar.oscar_server_id=nodes.id nodes.name </shortcut>
	<shortcut> oscar_version read_records oscar.oscar_version!=undef oscar.oscar_version </shortcut>
	<shortcut> package_id_to_name read_records packages.name packages.id=%1 </shortcut>
	<shortcut> package_name_to_id read_records packages.id packages.name=%1 </shortcut>
	<shortcut> package_set_id_to_name read_records package_sets.name package_sets.id=%1 </shortcut>
	<shortcut> package_set_name_to_id read_records package_sets.id package_sets.name=%1 </shortcut>
	<shortcut> package_set_selected modify_records packages packages.name=%1 selected~1 </shortcut>
	<shortcut> package_sets read_records package_sets.name </shortcut>
	<shortcut> package_unset_selected modify_records packages packages.name=%1 selected~0 </shortcut>
	<shortcut> packages read_records|modify_records packages name %+ </shortcut>
	<shortcut> packages_class_selected packages_selected class=%1 %+ </shortcut>
	<shortcut> packages_class_unselected packages_unselected class=%1 %+ </shortcut>
        <shortcut> packages_in_package_set read_records package_sets.name=%1 package_sets.id=package_set_package_entries.package_set_id package_set_package_entries.included_package_id=packages.id packages.name </shortcut>
	<shortcut> packages_installable read_records packages.name installable!=0 %+ </shortcut>
	<shortcut> packages_that_require read_records packages_requires package name=%1 </shortcut>
	<shortcut> packages_uninstallable read_records packages.name installable=0 %+ </shortcut>
	<shortcut> remove_all_packages_from_all_package_sets delete_records package_set_package_entries </shortcut>
	<shortcut> remove_all_packages_from_package_set delete_records package_set_package_entries package_sets.name=%1 package_sets.id=package_set_package_entries.package_set_id </shortcut>
	<shortcut> remove_disk_partition_from_disk_layout delete_records disk_partition_entries disk_partition_entries.partition=%1 disk_layouts.name=%2 disk_layouts.id=disk_partition_entries.disk_layout_id </shortcut>
	<shortcut> remove_dns_server_from_node delete_records node_dns_server_entries node_dns_server_entries.server=%1 nodes.name=%2 node_dns_server_entries.node_id=nodes.id </shortcut>
	<shortcut> remove_package_from_package_set delete_records package_set_package_entries packages.name=%1 package_sets.name=%2 package_sets.id=package_set_package_entries.package_set_id package_set_package_entries.included_package_id=packages.id</shortcut>
	<shortcut> remove_package_set_from_node delete_records node_package_set_entries node_package_set_entries.package_set_id=package_sets.id package_sets.name=%1 nodes.name=%2 node_package_set_entries.node_id=nodes.id </shortcut>
	<shortcut> rename_disk_layout modify_records disk_layouts disk_layouts.name=%1 disk_layouts.name~%2 </shortcut>
	<shortcut> rename_image modify_records images images.name=%1 images.name~%2 </shortcut>
	<shortcut> rename_network modify_records networks networks.name=%1 networks.name~%2 </shortcut>
	<shortcut> rename_node modify_records nodes nodes.name=%1 nodes.name~%2 </shortcut>
	<shortcut> rename_node_group modify_records node_groups node_groups.name=%1 node_groups.name~%2 </shortcut>
	<shortcut> rename_node_nic modify_records nics nodes.name=%1 nics.name=%2 nics.node_id=nodes.id nics.name~%3 </shortcut>
	<shortcut> rename_package_set modify_records package_sets package_sets.name=%1 package_sets.name~%2 </shortcut>
	<shortcut> selected_package_set read_records oscar.selected_package_set_id!=undef oscar.selected_package_set_id=package_sets.id package_sets.name </shortcut>
	<shortcut> set_oscar_server modify_records nodes.name=%1 oscar.oscar_server_id~nodes.id </shortcut>
	<shortcut> set_selected_package_set modify_records package_sets.name=%1 oscar.selected_package_set_id~package_sets.id </shortcut>
	<shortcut> this_package_requires read_records packages_requires package=%1 name </shortcut>
	<shortcut> unlink_node_from_disk_layouts modify_records nodes nodes.name=%1 nodes.disk_layout_id~undef </shortcut>
	<shortcut> unlink_node_from_images modify_records nodes nodes.name=%1 nodes.image_id~undef </shortcut>
	<shortcut> unlink_node_nic_from_networks modify_records nics nodes.name=%1 nics.name=%2 nics.node_id=nodes.id nics.network_id~undef </shortcut>
	<shortcut> which_disk_layout_has_node read_records disk_layouts.id=nodes.disk_layout_id nodes.name=%1 disk_layouts.name </shortcut>
	<shortcut> which_image_has_node read_records images.id=nodes.image_id nodes.name=%1 images.name </shortcut>
	<shortcut> which_networks_have_node read_records nodes.name=%1 nics.node_id=nodes.id nics.network_id=networks.id networks.name </shortcut>
	<shortcut> which_node_groups_have_group read_records node_groups.name=%1 node_groups.id=node_group_group_entries.included_group_id node_groups.name </shortcut>
	<shortcut> which_node_groups_have_node read_records nodes.name=%1 nodes.id=node_group_node_entries.included_node_id node_groups.name </shortcut>
	<shortcut> which_package_sets_have_package read_records packages.name=%1 package_set_package_entries.included_package_id=packages.id package_set_package_entries.package_set_id=package_sets.id package_sets.name </shortcut>
        <!--
        This defines the second field name for records in 
	the packages_rpmlist which can't be surmised from 
	the xml structure. If there were more than one 
	field name that needed to be specified for a 
	particular table, they would be specified all on 
	the same line.
        -->
        <fieldnames> packages_rpmlist scope </fieldnames>
     </oda>
  </package>

  <!--
  ==================================================
  ==================================================
  ==                                              ==
  ==    definitions of global database tables     ==
  ==                                              ==
  ==================================================
  ==================================================
   -->

  <database_tables>

    <disk_layouts>
      <fields> 
        <id> 
	  <type> integer </type>
	  <parameters> auto_increment not null unique primary key </parameters>
	</id>
        <name>
	  <parameters> not null unique </parameters>
	</name>
        <units> 
	  <default> mb </default>
	</units>
      </fields>
    </disk_layouts>

    <disk_partition_entries>
      <fields> 
        <active/>
        <bootable/>
        <disk_layout_id>
	  <type> integer </type>
	</disk_layout_id>
        <mount_point/>
        <offset>
	  <type> integer </type>
	</offset>
        <partition/>
        <size>
	  <type> integer </type>
	</size>
        <type/>
      </fields>
    </disk_partition_entries>

    <images>
      <fields> 
        <id> 
	  <type> integer </type>
	  <parameters> auto_increment not null unique primary key </parameters>
	</id>
        <name>
	  <parameters> not null unique </parameters>
	</name>
        <path/>
      </fields> 
    </images>

    <networks>
      <fields> 
        <cluster_only> 
	  <type> integer </type>
	</cluster_only>
        <id> 
	  <type> integer </type>
	  <parameters> auto_increment not null unique primary key </parameters>
	</id>
        <name>
	  <parameters> not null unique </parameters>
	</name>
      </fields> 
    </networks>

    <nics>
      <fields> 
        <assignment_method/>
        <broadcast/>
        <driver_module/>
        <id> 
	  <type> integer </type>
	  <parameters> auto_increment not null unique primary key </parameters>
	</id>
        <interface/>
        <ip/>
        <mac/>
        <netmask/>
        <network_id>
	  <type> integer </type>
	</network_id>
        <node_id>
	  <type> integer </type>
	</node_id>
      </fields> 
    </nics>

    <nodes>
      <fields> 
        <cpu_num> 
	  <type> integer </type>
	</cpu_num>
        <cpu_speed> 
	  <type> integer </type>
	</cpu_speed>
        <cpu_type/>
        <default_gateway/>
        <domain/>
	<fqdn/>
        <hostname/>
        <id> 
	  <type> integer </type>
	  <parameters> auto_increment not null unique primary key </parameters>
	</id>
        <image_id>
	  <type> integer </type>
	</image_id>
	<installer/>
        <name>
	  <parameters> not null unique </parameters>
	</name>
        <ram> 
	  <type> integer </type>
	</ram>
        <swap> 
	  <type> integer </type>
	</swap>
        <units> 
	  <default> mb </default>
	</units>
      </fields>
    </nodes>

    <node_groups>
      <fields> 
        <id> 
	  <type> integer </type>
	  <parameters> auto_increment not null unique primary key </parameters>
	</id>
        <name>
	  <parameters> not null unique </parameters>
	</name>
      </fields>
    </node_groups>

    <node_group_group_entries>
      <parameters> unique(included_node_group_id,node_group_id) </parameters>
      <fields> 
        <included_node_group_id>
	  <type> integer </type>
	</included_node_group_id>
        <node_group_id>
	  <type> integer </type>
	</node_group_id>
      </fields>
    </node_group_group_entries>

    <node_group_node_entries>
      <parameters> unique(included_node_id,node_group_id) </parameters>
      <fields> 
        <included_node_id>
	  <type> integer </type>
	</included_node_id>
        <node_group_id>
	  <type> integer </type>
	</node_group_id>
      </fields>
    </node_group_node_entries>

    <oscar>
      <fields> 
        <installation_date/>
        <oscar_server_node_id>
	  <type> integer </type>
	</oscar_server_node_id>
	<selected_package_set_id>
	  <type> integer </type>
	</selected_package_set_id>
        <oscar_version/>
      </fields>
    </oscar>

    <!--
    Note that fields in the packages table will also
    be defined by the combination of all the fields 
    found in all of the config.xml files for each package.
    The selected field and another fields that are not
    found in the package config.xml files has to be
    defined here. All the fields are defined here anyway
    to ensure the types of fields and other things such
    as default values and whether fields are required to
    have a value.
    -->
    <packages>
      <fields>
        <class/>
	<copyright/>
	<group/>
        <id> 
	  <type> integer </type>
	  <parameters> auto_increment not null unique primary key </parameters>
	</id>
	<installable/>
	<license/>
	<maintainer_email/>
	<maintainer_name/>
        <name>
	  <parameters> not null unique </parameters>
	</name>
	<package/>
	<packager_email/>
	<packager_name/>
        <selected> 
	  <type> integer </type>
	  <default> 0 </default>
	</selected>
	<summary/>
	<url/>
	<vendor/>
	<version_epoch/>
	<version_major> 
	  <type> integer </type>
	</version_major>
	<version_minor> 
	  <type> integer </type>
	</version_minor>
	<version_release/>
	<version_subversion/>
      </fields>
    </packages>	

    <package_sets>
      <fields> 
        <id> 
	  <type> integer </type>
	  <parameters> auto_increment not null unique primary key </parameters>
	</id>
        <name>
	  <parameters> not null unique </parameters>
	</name>
      </fields>
    </package_sets>

    <package_set_package_entries>
      <parameters> unique(included_package_id,package_set_id) </parameters>
      <fields> 
        <included_package_id>
	  <type> integer </type>
	</included_package_id>
        <package_set_id>
	  <type> integer </type>
	</package_set_id>
      </fields>
    </package_set_package_entries>

    <package_set_set_entries>
      <parameters> unique(included_package_set_id,package_set_id) </parameters>
      <fields> 
        <included_package_set_id>
	  <type> integer </type>
	</included_package_set_id>
        <package_set_id>
	  <type> integer </type>
	</package_set_id>
      </fields>
    </package_set_set_entries>

  </database_tables>

</oscar>
