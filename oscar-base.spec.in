# $Id$

%define bindir /usr/bin
%define etcdir /etc/oscar
%define docdir /usr/share/doc/oscar
%define sharedir /usr/share/oscar
%define mandir /usr/local/man/man1
%define _unpackaged_files_terminate_build 0

Summary: 	Base OSCAR package
Name: 		oscar-base
Version: 	OSCARVERSION
Release: 	1
License: 	GPL
URL: 		http://oscar.openclustergroup.org
Group: 		Applications/System
Source: 	%{name}-%{version}.tar.gz
Requires: 	%{name}-lib
Requires: 	%{name}-scripts
Requires: 	yum, createrepo, yume
Vendor: 	OSCAR
Distribution: 	OSCAR
Packager: 	Geoffroy Vallee

Buildroot: 	%{_tmppath}/%{name}-%{version}-root
BuildArch: 	noarch
AutoReqProv: 	no

%description
Base OSCAR package.
OSCAR allows users, regardless of their experience level with a *nix
environment, to install a Beowulf type high performance computing cluster. It
also contains everything needed to administer and program this type of HPC
cluster. OSCAR's flexible package management system has a rich set of
pre-packaged applications and utilities which means you can get up and running
without laboriously installing and configuring complex cluster administration
and communication packages. It also lets administrators create customized
packages for any kind of distributed application or utility, and to distribute
those packages from an online package repository, either on or off site.

%prep
%setup -n %{name}-%{version}
/usr/bin/patch -s -p1 share/prereqs/base/prereq.cfg debian/patches/01_base_prereq.patch

%build
rm -rf %{buildroot}
make system-install DESTDIR=%{buildroot}
mkdir -p %{buildroot}%{etcdir}
mkdir -p %{buildroot}%{docdir}
mkdir -p %{buildroot}%{sharedir}/images
cp debian/etc/oscar.conf %{buildroot}%{etcdir}
cp -f COPYING %{buildroot}%{docdir}
cp -f README %{buildroot}%{docdir}
cp -f VERSION %{buildroot}%{docdir}
cp -f images/oscar.gif %{buildroot}%{sharedir}/images
cp -rf packages/yume/ %{buildroot}%{sharedir}/prereqs
cp -rf packages/rapt/ %{buildroot}%{sharedir}/prereqs
cp -rf packages/oda/  %{buildroot}%{sharedir}/prereqs

%clean
rm -rf %{_tmppath}/%{name}-%{version}-root


%package client
Group: Applications/System
Summary: Libraries for OSCAR clustering package.
AutoReqProv: no
%description client
Requires: %{name}-scripts == %{version}-%{release}
Dummy package for oscar-base-client install.


%package server
Group: Applications/System
Summary: Libraries for OSCAR clustering package.
AutoReqProv: no
%description server
Requires: %{name} == %{version}-%{release}
Dummy package for oscar-base-server install.


%package lib
Group: Applications/System
Summary: Libraries for OSCAR clustering package.
AutoReqProv: no
%description lib
Libraries for OSCAR clustering base package.


%package scripts
Group: Applications/System
Summary: Libraries for OSCAR clustering package.
Requires: %{name}-lib == %{version}-%{release}
AutoReqProv: no
%description scripts
Scripts for OSCAR clustering base package.


%files
%defattr(-,root,root)
%dir %{etcdir}
%dir %{sharedir}/prereqs
%dir %{mandir}
%{etcdir}/*
%{sharedir}/*
%{mandir}/*
%{docdir}/*

%files client
%defattr(-,root,root)

%files server
%defattr(-,root,root)

%files lib
%defattr(-,root,root)
%dir /usr/lib/
/usr/lib/*

%files scripts
%defattr(-,root,root)
%dir %{bindir}
%dir %{bindir}/system-sanity.d
%{bindir}/*

%changelog
* Tue Dec 02 2008 Geoffroy Vallee <valleegr@ornl.gov>
- Add the /usr/bin/system-sanity.d directory into the scripts RPM.
* Wed Nov 26 2008 Geoffroy Vallee <valleegr@ornl.gov>
- Modify the spec file to be based on the Makefile.
- Install OSCAR directly into the system, instead of using /opt.
* Thu Nov 29 2007 Bernard Li <bernard@vanhpc.org>
- Added directories to the %files sections so that they will be removed
  when the RPMs are uninstalled
* Thu Oct 4 2007 Erich Focht
- Initial package.
