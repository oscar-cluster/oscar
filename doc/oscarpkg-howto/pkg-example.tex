% $Id: pkg-example.tex,v 1.2 2003/09/10 03:31:28 naughtont Exp $

\section{Example Package}
\label{sect:example-pkg}

\subsection{A basic \file{config.xml}}
\label{sect:example-config-xml}

\subsection{Using the Configurator}
\label{sect:example-configurator}

The following is an example \file{configurator.html} used to setup a
configuration file.  Default values are seeded so a user can simply click
``Ok'' if they like.

\begin{small}
\begin{verbatim}
<html>
<head> <title>SSSLib Configuration Settings</title> </head> 
<body>

<form>
<h2>Setup SSSLib Configuration File</H2>
<br>

<p> Hostname where Service Directory runs<br>
<input  name="sd_host"      value="oscar_server"><br>

<p> Port number for Service Directory<br>
<input  name="sd_port"      value="7000"><br>

<p> Default protocol for Service Directory<br>
(Valid: challenge OR basic)<br>
<input  name="sd_protocol"  value="challenge">  

<p> Preference ordering for protocols<br>
<input name="prefs"         value="challenge,basic"><br>

<p> Cluster name<br>
<input name="cluster"       value="oscar_cluster"><br>

<p> Challenge protocol password<br>
(Currently stored in plain text)<br>
<input name="password"      value="OscarSSSpass"><br>   

<p> <input type="checkbox"   name="msg_log"   value="/var/log/sss_msg.log">
Enable message logging (logfile='/var/log/sss_msg.log')<br>

<p> <input type="checkbox"   name="syslog_sss"   value="/var/log/sss.log">   
Enable additional logging via syslog (logfile='/var/log/sss.log')<br>

<br> <p> <input type=reset value='Reset Form'>

</form>
</body> </html>
\end{verbatim}
\end{small}


\subsubsection{post\_configure}

This is a simple \file{post\_configure} example that process the results
of the Configurator that are stored in the XML \file{.configurator.values}
file.  This reads those values to generate a configuration file
\file{/etc/ssslib.conf}.

\begin{small}
\begin{verbatim}
  #!/usr/bin/env perl
  # 'post_configure' -- reads Configurator result to setup '/etc/ssslib.conf'

  use XML::Simple;
  use Carp;

  my @fields = (sd_host, sd_port, sd_protocol, prefs, cluster, password, 
                msg_log, syslog_sss);
  my $conf     = ">/etc/ssslib.conf";
  my $xml_data = "$ENV{OSCAR_PACKAGE_HOME}/.configurator.values";


  my $ref = XMLin($xml_data) or croak("Error: unable to open ($xml_data)");
  open(CONF, $conf) or croak("Error: unable to open ($conf)\n");

  print CONF "# SSSLib configuration file\n# Generated by OSCAR\n\n";
  foreach $key  (@fields) {
          if( defined($ref->{"$key"}) ) {
                  print CONF $key, "=", $ref->{$key}, "\n";
          }
  }
  print CONF "\n";

  close(CONF);
\end{verbatim}
\end{small}
