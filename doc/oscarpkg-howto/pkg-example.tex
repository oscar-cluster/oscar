% $Id: pkg-example.tex,v 1.3 2003/09/10 04:38:33 naughtont Exp $

\section{Example Package}
\label{sect:example-pkg}

\subsection{A basic \file{config.xml}}
\label{sect:example-config-xml}

The following shows the meta file for a package called SSSlib.  

\begin{verse}
   {\bfseries Notice: } Due to the XML parser module used, currently
   multi-line elements like \xmltag{description} must have the closing tag
   on the same line as the last line of text.  
\end{verse}


\begin{scriptsize}
\begin{verbatim}
<?xml version="1.0" encoding="ISO-8859-1"?>
<oscar>
  <name>SSSLib</name>

  <version>
    <major>0</major>
    <minor>95</minor>
    <subversion>2</subversion>
    <release>1</release>
    <epoch>1</epoch>
  </version>

  <class>third-party</class>
  <installable>1</installable>

  <summary>SciDAC:SSS Infrastructure components</summary>
  <license>GPL</license>
  <group>Application/System</group>
  <url>http://www.scidac.org/ScalableSystems</url>
  
  <maintainer>
     <name>Narayan Desai</name>
     <email>narayan@anl.gov</email>
  </maintainer>

  <packager>
    <name>Thomas Naughton</name>
    <email>naughtont@ornl.gov</email>
  </packager>

  <description>The BCWG Infrastructure components for the SciDAC: Scalable 
Systems Software.  These infrastructure components include the Service 
Directory, Event Manager, etc. as well as the communication 
library. </description>

  <rpmlist>
        <filter distribution="redhat" distribution_version="7.2" arch="ia32"/>
        <filter distribution="redhat" distribution_version="7.3"/>
        <rpm>ssslib</rpm>
        <rpm>sss-clients</rpm>
        <rpm>sss-infrastructure</rpm>
        <rpm>ssslib-perl</rpm>
        <rpm>ssslib-python</rpm>
        <rpm>sss-nsm-client</rpm>
        <rpm>sss-old</rpm>
        <rpm>sss-schemas</rpm>
        <rpm>sss-validate</rpm>
        <rpm>sss-validate-python</rpm>
	</rpmlist>

	<rpmlist>
        <filter group="oscar_server" distribution="redhat" distribution_version="7.2"/>
        <filter group="oscar_server" distribution="redhat" distribution_version="7.3"/>
        <rpm>sss-mayor-slave</rpm>
        <rpm>sss-servers</rpm>
  </rpmlist>
</oscar>
\end{verbatim}
\end{scriptsize}


\subsection{Using the Configurator}
\label{sect:example-configurator}

The following is an example \file{configurator.html} used to setup a
configuration file.  Default values are seeded so a user can simply click
``Ok'' if they like.

\begin{scriptsize}
\begin{verbatim}
<html>
<head> <title>SSSLib Configuration Settings</title> </head> 
<body>

<form>
<h2>Setup SSSLib Configuration File</H2>
<br>

<p> Hostname where Service Directory runs<br>
<input  name="sd_host"      value="oscar_server"><br>

<p> Port number for Service Directory<br>
<input  name="sd_port"      value="7000"><br>

<p> Default protocol for Service Directory<br>
(Valid: challenge OR basic)<br>
<input  name="sd_protocol"  value="challenge">  

<p> Preference ordering for protocols<br>
<input name="prefs"         value="challenge,basic"><br>

<p> Cluster name<br>
<input name="cluster"       value="oscar_cluster"><br>

<p> Challenge protocol password<br>
(Currently stored in plain text)<br>
<input name="password"      value="OscarSSSpass"><br>   

<p> <input type="checkbox"   name="msg_log"   value="/var/log/sss_msg.log">
Enable message logging (logfile='/var/log/sss_msg.log')<br>

<p> <input type="checkbox"   name="syslog_sss"   value="/var/log/sss.log">   
Enable additional logging via syslog (logfile='/var/log/sss.log')<br>

<br> <p> <input type=reset value='Reset Form'>

</form>
</body> </html>
\end{verbatim}
\end{scriptsize}


\subsubsection{post\_configure}

This is a simple \file{post\_configure} example that process the results
of the Configurator that are stored in the XML \file{.configurator.values}
file.  This reads those values to generate a configuration file
\file{/etc/ssslib.conf}.

\begin{scriptsize}
\begin{verbatim}
  #!/usr/bin/env perl
  # 'post_configure' -- reads Configurator result to setup '/etc/ssslib.conf'

  use XML::Simple;
  use Carp;

  my @fields = (sd_host, sd_port, sd_protocol, prefs, cluster, password, 
                msg_log, syslog_sss);
  my $conf     = ">/etc/ssslib.conf";
  my $xml_data = "$ENV{OSCAR_PACKAGE_HOME}/.configurator.values";


  my $ref = XMLin($xml_data) or croak("Error: unable to open ($xml_data)");
  open(CONF, $conf) or croak("Error: unable to open ($conf)\n");

  print CONF "# SSSLib configuration file\n# Generated by OSCAR\n\n";
  foreach $key  (@fields) {
          if( defined($ref->{"$key"}) ) {
                  print CONF $key, "=", $ref->{$key}, "\n";
          }
  }
  print CONF "\n";

  close(CONF);
\end{verbatim}
\end{scriptsize}
