% -*- latex -*-
%
% $Id: security.tex,v 1.5 2002/08/31 16:29:36 jsquyres Exp $
%
% $COPYRIGHT$
%

\section{Security}
\label{app:security}

\subsection{Security layers}
Linux cluster security should, ideally, consist of multiple layers.
The main security layers are router packet filtering, network stack
protections, host based packet filtering, TCP wrappers, service
paring, service configuration, and secure communications.  Oscar
installs a host based packet filtering package called
\rpmname{pfilter}.

\subsection{Router packet filtering}

This involves adding packet filtering rules to your border network
router.  Normally, this is not done because of the difficulty in
modifying router tables. Packet filtering involves looking at each
network packet, and deciding whether each packet should be allowed,
dropped, or rejected, based on tables of rules.

\subsection{Network stack protections}

Linux kernels have security features built in that can help prevent
outsiders from pretending that they are part of your internal network.
These features are enabled through \file{/proc} filesystem entries.  A
good firewall package will turn these on appropriately
(\rpmname{pfilter} does this when enabled).

\subsection{Host based packet filtering}

Like router packet filtering, host based network packet filtering
involves examining each packet and deciding what do do with it.  But
with host based filtering, each machine individually filters the
network packets going to, from, or through it.  Linux kernels from 2.4
on include support for connection tracking and ``statefull'' packet
filtering, which keeps track of ongoing network connections, allowing
better filtering decisions to be made based on whether packets are
part of an already allowed connection.

The problem with packet filtering is that it requires generating
filtering ``rulesets'' that the \cmd{iptables} or \cmd{ipchains}
programs interpret and store in the running kernel.  Creating these
rulesets is similar to writing software in assembly language. There
are now higher level ``languages'' and compilers that can be used to
generate the rulesets and provide firewalls.  OSCAR installs a ruleset
compiler/firewall package called \rpmname{pfilter}.  For more
information, see the \url{http://pfilter.sourceforge.net/}.

\subsection{TCP Wrappers}

TCP wrappers are an access control system that allows control over
which network addresses or address ranges can access particular
network services on a computer host.  This is controlled by the
\file{/etc/hosts.allow} and \file{/etc/hosts.deny} files. This allows
certain services to be only accessible from your local domain, for
instance.  A common use of this would be to limit exported NFS
filesystems to only be accessible from your local domain, while
allowing security logins through \cmd{ssh} to come in from anywhere.
This would be done with a \file{/etc/hosts.deny} file that looks like
this:

\begin{verbatim}
  ALL:   ALL
\end{verbatim}

\noindent and a \file{/etc/hosts.allow} file that looks like this:

\begin{verbatim}
  # allow NFS service to domain.net only
  portmap:      .domain.net
  rpc.mountd:   .domain.net
  # allow ssh logins from anywhere
  sshd:         ALL
\end{verbatim}

\subsection{Service paring}

This is probably the most used of all the security layers, since
turning off unneeded network services gets rid of opportunities for
network breakins.  To hunt down and turn off unwanted services, the
\cmd{lsof}, \cmd{chkconfig}, and \cmd{service} system commands can be
used.  To display which network services are currently listening on a
system, do this:

\begin{verbatim}
  # lsof -i | grep LISTEN | awk '{print $1,$(NF-2),$(NF-1)}' | sort | uniq
\end{verbatim}

\noindent To list the services that will be started by default at the
current runlevel do this:

\begin{verbatim}
  # chkconfig --list | grep `grep :initdefault: /etc/inittab | \
    awk -F: '{print $2}'`:on | awk '{print $1}' | sort | column
\end{verbatim}

\noindent To find services started by \cmd{xinetd} do this:

\begin{verbatim}
  # chkconfig --list | awk 'NF==2&&$2==''off''{print}' | \
    awk -F: '{print $1}' | sort | column
\end{verbatim}

The \cmd{nmap} port scanning command is also useful to get a
hackers-eye view of your systems.  The \cmd{chkconfig} and
\cmd{service} commands can be used to turn on and off system services.

\subsection{Service configuration}

Some network services have their own configuration files. These should
be edited to tighten down outside access.  For example, the NFS
filesystem uses the \file{/etc/exports} to determine which network
addresses can access individual file systems, and which have
read-write or read-only access.  Indeed, OSCAR sets
\file{/etc/exports} to only NFS export the \file{/home} directory to
the OSCAR cluster nodes.

\subsection{Secure communications}

The OSCAR team {\em strongly} recomends using \cmd{ssh} for all
network logins, and \cmd{scp} to copy files either between OSCAR
nodes, or to remote hosts.  The use of \cmd{telnet}, \cmd{rsh},
\cmd{ftp}, and other legacy network applications are strongly
discouraged because of inherent security risks (passwords are
transmitted ``in the clear'').  

\cmd{ssh} and \cmd{scp} are fully functional replacements for these
legacy commands -- OSCAR takes care of setting up all the
authentication and key management issues for all users.

% LocalWords:  ngorsuch Exp
