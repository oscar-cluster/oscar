% -*- latex -*-
%
% $Id: detailed.tex,v 1.41 2002/09/02 14:30:02 jsquyres Exp $
%
% $COPYRIGHT$
%

\section{Detailed Cluster Installation Procedure}
\label{sec:detail}

All actions specified herein should be performed by the \user{root}
user on the server node unless noted otherwise.  Note that if you
login as a regular user and use the \cmd{su} command to change to the
\user{root} user, you {\em must} use ``\cmd{su -}'' to get the full
\user{root} environment.  Using ``\cmd{su}'' (with no arguments) may
not be sufficient, and may cause obscure errors during an OSCAR
installation.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Server Installation and Configuration}
\label{det:serverinstall}
  
During this phase, you will prepare the machine to be used as the
server node in the OSCAR cluster.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsubsection{Install Linux on the server machine} 
\label{det:serverosinstall}

If you have a machine you want to use that already has Linux
installed, ensure that it meets the minimum requirements as listed in
Section~\ref{sec:intro-min-sys}.  If it does, you may skip ahead to
Section~\ref{det:serverdiskpar}.

It should be noted that OSCAR is only supported on the distributions
listed in Table~\ref{tab:oscar-distro-support}
(page~\pageref{tab:oscar-distro-support}).  As such, use of
distributions other than those listed will likely require some porting
of OSCAR, as many of the scripts and software within OSCAR are
dependent on those distributions. 

When installing Linux, do not worry about doing a ``custom'' install
since OSCAR will install all the software on which it depends.  The
main Linux installation requirement is that some X windowing
environment such as GNOME or KDE must be installed.  Typically, a
``Workstation'' install with the ``Software Development Tools'' group
added yields a sufficient installation for OSCAR to install
successfully.

\begin{discuss}
  Is the above a true statement?
\end{discuss}

If you install RedHat on the server node, during the installation you
do not need to install the \rpmname{ipchains}-based firewall that is
included with the RedHat distribution, because OSCAR will install an
\rpmname{iptables} based packet filtering firewall named
\rpmname{pfilter} which is more versatile.  OSCAR does not turn on
\rpmname{pfilter} by default, however.  If the RedHat
\rpmname{ipchains} based firewall is installed, the OSCAR installation
will fail.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsubsection{Disk space and directory considerations}
\label{det:serverdiskpar}

OSCAR has certain requirements for server disk space. Space will be
needed to store the Linux RPMs and to store the images.  The RPMs will
be stored in \file{/tftpboot/rpm}. Approximately 2GB is required to
store the RPMs.  The images are stored in \file{/var/lib/systemimager}
and will need approximately 2GB per image. Only one image is required,
although you may want to create more in the future.

If you are installing a new server, it is suggested that you allow for
4GB in both the \file{/} (which contains \file{/tftpboot}) and
\file{/var} filesystems when partitioning the disk on your server.

If you are using an existing server, you will need to verify that you
have enough space on the disk partitions.  Again 2GB of free space is
recommended under each of \file{/} and \file{/var}.

You can check the amount of free space on your drive's partitions by
issuing the command \cmd{df -h} in a terminal.  The result for each
file system is located below the \cmd{Available} column heading. If
your root (\file{/}) partition has enough free space, enter the
following command in a terminal:

\begin{verbatim}
  # mkdir -p /tftpboot/rpm
\end{verbatim}
  
If your root partition does not have enough free space, create the
directories on a different partition that does have enough free space
and create symbolic links to them from the root (\file{/}) directory.
For example, if the partition containing \file{/usr} contains enough
space, you could do so by using the following commands:

\begin{verbatim}
  # mkdir -p /usr/tftpboot/rpm
  # ln -s /usr/tftpboot /tftpboot
\end{verbatim}

The same procedure should be repeated for the
\file{/var/lib/systemimager} subdirectory.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    
\subsubsection{Get a copy of OSCAR and unpack on the server} 
\label{det:unpack}

If you are reading this, you probably already have a copy of an OSCAR
distribtuion package.  If not, go to
\url{http://oscar.sourceforge.net/} and download the latest OSCAR
Regular or Extra Crispy distribution package (see
Section~\ref{sec:download}, page~\pageref{sec:download}).

Place the OSCAR distribution package to a directory such as
\user{root}'s home directory on the server node.  Although there is no
required installation directory (note that you may not use the
directory \file{/usr/local/oscar} or \file{/opt/oscar} -- they are
both reserved for future use), the rest of these instructions will
assume that you downloaded the OSCAR distribution package to
\user{root}'s home directory.

Do {\bf not} unpack the tarball on a Windows-based machine and copy
the directories over to the server, as this will convert all the
scripts to ``DOS'' format and will render them useless under Linux.

Open a command terminal and issue the following commands to unpack the
OSCAR distribution package:

\begin{verbatim}
  # cd
  # tar zxf <filename>
\end{verbatim}

Where \file{$<$filename$>$} is either
\file{oscar-\oscarversion.tar.gz} (regular distribution) or
\file{oscar\--including\--srpms\--\oscarversion.tar.gz} (extra crispy
distribution).

\def\obase{$^\sim$/oscar-\oscarversion}

\begin{table}[htbp]
  \begin{center}
    \begin{tabular}{|l|p{3in}|}
      \hline
      \multicolumn{1}{|c|}{Directory} &
      \multicolumn{1}{|c|}{Contents} \\
      \hline
      \hline
      \file{\obase/} & the base OSCAR directory \\
%
      \file{\obase/COPYING} & GNU General Public License
      v2 \\
%
      \file{\obase/doc} & OSCAR documentation directory \\
%
      \file{\obase/images} & auxiliary images used in the GUI \\
%
      \file{\obase/install\_cluster} & main installation script \\
%
      \file{\obase/lib} & auxiliary library routines \\
%
      \file{\obase/oscarsamples} & sample configuration files \\
%
      \file{\obase/packages} & RPM and installation files for the
      OSCAR packages \\
%
      \file{\obase/README} & text README document \\
%
      \file{\obase/scripts} & contains scripts that do most of the
      work \\
%
      \file{\obase/share} & more auxiliary helper files \\
%
      \file{\obase/testing} & contains OSCAR cluster test software \\
%
      \file{\obase/VERSION} & file containing the OSCAR version number \\
      \hline
    \end{tabular}
    \caption{OSCAR distribution package file and directory layout.}
    \label{tab:oscar-dir-struct}
  \end{center}
\end{table}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsubsection{Configure the ethernet adapter for the cluster} 
\label{det:serveradapter}

Assuming you want your server to be connected to both an public
network and the private cluster subnet, you will need to have two
ethernet adapters installed in the server. It is preferred that you do
this because exposing your cluster may be a security risk, and certain
software used in OSCAR (such as DHCP) may conflict with your external
network.

\begchange

Once both adapters have been physically installed in the server node,
you need to configure them.\footnote{Beware of certain models of 3COM
  network cards.  See footnote~\ref{foot:3com-warning} on
  page~\pageref{foot:3com-warning}.}  Any network configurator is
sufficient; popular applications include \cmd{neat}, \cmd{netcfg}, or
a text editor.

The following major requirements need to be satisfied:

\paragraph{Hostname.} Most Linux distributions default to the hostname
``{\tt localhost}'' (or ``{\tt localhost.localdomain}'').  This must
be changed in order to successfully install OSCAR -- choose another
name that does not include any underscores (``{\tt \_}'').

\paragraph{Public adapter.}  This is the adapter that connects the
server node to a public network.  Although it is not required to have
such an adapter, if you do have one, you must configure it as
appropriate for the public network (you may need to consult with your
network administrator).

\paragraph{Private adapter.}  This is the adapter connected to
the TCP/IP network with the rest of the cluster nodes.  This adapter
must be configured as follows:

\begin{itemize}
\item Use a private IP address\footnote{There are three private IP
    address ranges: 10.0.0.0 to 10.255.255.255; 172.16.0.0 to
    172.32.255.255; and 192.168.0.0 to 192.168.255.255.  Additional
    information on private intranets is available in RFC 1918.  You
    should not use the IP addresses 10.0.0.0 or 172.16.0.0 or
    192.168.0.0 for the server.  If you use one of these addresses,
    the network installs of the client nodes will fail.
    \label{foot:private-ip-ranges}}

\item Use an appropriate netmask\footnote{A class C netmask of
    255.255.255.0 should be sufficient for most OSCAR clusters.
    \label{foot:netmask}} 

\item Ensure that the interface is activated at boot time

\item Set the interface control protocol to ``none''

\end{itemize}

\endchange

Now reboot the server node to ensure that all the changes are
propagated to the appropriate configuration files. To confirm that all
ethernet adapters are in the ``up'' state, once the machine has
rebooted, open another terminal window and enter the following
command:

\begin{verbatim}
  # ifconfig -a
\end{verbatim}
  
You should see {\tt UP} as the first word on the third line of output
for each adapter. If not, there is a problem that you need to resolve
before continuing. Typically, the problem is that the wrong module is
specified for the given device. Try using the network configuration
utility again to resolve the problem.
  
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsubsection{Copy distribution installation RPMs to \file{/tftpboot/rpm}}
\label{det:rpmcopy}

In this step, you need to copy the RPMs included with your Linux
distribution into the \file{/tftpboot/rpm} directory.  When each CD is
inserted, Linux should automatically make the contents of the CD be
available in the \file{/mnt/cdrom} directory (you may need to execute
the command ``\cmd{mount /dev/cdrom}'' if the CD does not mount
automatically).  Then for each CD, locate the directory that contains
the RPMs.  In RedHat 7.1, the RPMs are located in the
\file{RedHat/RPMS} directory (i.e., \file{/mnt/cdrom/RedHat/RPMS}).
After locating the RPMs on the each CD, copy them into
\file{/tftpboot/rpm} with a command such as:

\begin{verbatim}
  # cp /mnt/cdrom/RedHat/RPMS/*.rpm /tftpboot/rpm
\end{verbatim}
  
Be sure to repeat the above process for all CDs.  After using each CD
you will have to unmount it from the local file system and eject it by
issuing these commands:

\begin{verbatim}
  # cd
  # eject cdrom
\end{verbatim}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsubsection{Copy distribution update RPMs to \file{/tftpboot/rpm}}
\label{det:distro-updates}

Obtain all the relevant RPM updates for your distribution -- security
patches, bug fixes, etc.  Most distributions (including RedHat)
include a tool to automate this process (e.g., \cmd{up2date}) that
will automatically download and install all relevant updated RPMs.

Ensure that these updated RPMs are also copied to
\file{/tftpboot/rpm}.  It does not matter if two different versions of
the same RPM end up in \file{/tftpboot/rpm} (e.g.,
\file{foo-1.2.3-1.i386.rpm} from the installation CD and
\file{foo-1.2.4-1.i386.rpm} from the updates) -- OSCAR will
automatically use the latest version when it selects RPMs to install.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  
\subsection{Initial OSCAR Server Configuration}

During this phase, the software needed to run OSCAR will be installed
on the server. In addition, some initial server configuration will be
performed. 

The following steps must be run within an X windowing environment.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsubsection{Change to the OSCAR directory and run \file{install\_cluster}}
\label{det:installcluster}

Change directory to the top-level OSCAR directory and start the OSCAR
install wizard:

% We have to use \tt instead of {verbatim} because we need to use
% \oscarversion inside.  This makes it somewhat painful -- much less
% easy than {verbatim}.
\vspace{11pt}
{\tt
\# cd /root/oscar-\oscarversion \\
\indent \# ./install\_cluster $<$device$>$
}
\vspace{11pt}
  
In the above command, substitute the device name (e.g., \emph{eth1})
in place of \cmd{$<$device$>$} for your server's private network
ethernet adapter.  The script will execute some setup / configuration
setps, including:

\begin{enumerate}
\item copies OSCAR RPMs to \file{/tftpboot/rpm}
\item installs all OSCAR server RPMs
\item updates \file{/etc/hosts} with OSCAR aliases
\item updates \file{/etc/exports} 
\item adds OSCAR paths to \file{/etc/profile} 
\item updates system startup (\file{/etc/rc.d/init.d}) scripts
\item restarts affected services
\end{enumerate}

After these steps have successfully finished, the OSCAR installation
wizard GUI will automatically be launched.
  
The wizard, as shown in Figure~\ref{fig:detailed-oscar-wizard}, is
provided to guide you through the rest of the cluster installation.
To use the wizard, you will complete a series of steps, with each step
being initiated by the pressing of a button on the wizard. Do not go
on to the next step until the instructions say to do so, as there are
times when you may need to complete an action outside of the wizard
before continuing on with the next step. For each step, there is also
a \button{Help} button located directly to the right of the step
button.  When pressed, the \button{Help} button displays a message box
describing the purpose of the step.

\begin{figure}[htbp]
  \begin{center}
    \includegraphics{figs/2_sbs-oscar-wizard.\figext}
    \caption{OSCAR Wizard.}
    \label{fig:detailed-oscar-wizard}
  \end{center}
\end{figure}
  
As each of the steps are performed, there is output generated that is
displayed to the user. 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Cluster Definition}
\label{sec:detailed-cluster-def}

During this phase, you will complete steps 1 through 6 of the OSCAR
wizard in defining your cluster.  If you encounter problems or wish to
redo any of the SIS actions performed in the wizard steps 2 or 3,
please refer to the \cmd{SIS(1)} man pages.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsubsection{Step 1: Prepare OSCAR server for install} 
\label{det:prepareforinstall}

Begin the installation process by pressing the Step 1 button of the
wizard entitled \button{Prepare OSCAR Server for Install}. 

Here you will select the default MPI implementation for use on the
cluster.  Note that all available MPI implementations will be
available for general use; this step simply picks which one will be
the system default.

This step also installs and starts other necessary software, devices,
and services on the server.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsubsection{Step 2: Build the Image} 
\label{det:buildimage}

Press the Step 2 button of the wizard entitled \button{Build OSCAR
  Client Image}. A dialog will be displayed. In most cases, the
defaults will be sufficient. You should verify that the disk partition
file is the proper type for your client nodes. The sample files have
the disk type as the last part of the filename. You may also want to
change the post installation action and the IP assignment methods.
\msg{It is important to note that if you wish to use automatic reboot,
  you should make sure the BIOS on each client is set to boot from the
  local hard drive before attempting a network boot by default. If you
  have to change the boot order to do a network boot before a disk
  boot to install your client machines, you should not use automatic
  reboot.}  

Building the image may take several minutes; the red progress bar on
the bottom of the window will indicate how far along the process is.

There is a lot of output in the console window during the build.  It
is normal to see some warning messages in the console.  You can safely
ignore these messages and wait for the final popup window announcing
the success or failure of the overall image build.
  
A sample dialog is shown in Figure~\ref{fig:detailed-build-image}.

\begin{figure}[htbp]
  \begin{center}
    \includegraphics{figs/4a_sbs-build-image1.\figext}
    \caption{Build the image.}
    \label{fig:detailed-build-image}
  \end{center}
\end{figure}
  
\paragraph{Customizing your image.}

The defaults of this panel use the sample disk partition and RPM
package files that can be found in the \file{oscarsamples} directory.
You may want to customize these files to make the image suit your
particular requirements.

\subparagraph{Disk partitioning.}

The disk partition file contains a line for each partition desired,
where each line is in the following format:

\begin{verbatim}
  <partition> <size in megabytes> <type> <mount point> <options>
\end{verbatim}

Here is a sample (for a SCSI disk):

% Actually include the real file so that we're never out of sync with
% what is shipped in the OSCAR distribution.

\verbatiminput{../../oscarsamples/sample.disk.scsi}

The last partition specified will grow to fill the entire disk.  You
can create your own partition files, but make sure that you do not
exceed the physical capacity of your client hardware. Also be careful
to not specify duplicate filesystems as this will cause problems 
during the installation. The sample listed above, and some others, 
are in the \file{oscarsamples} directory.

\subparagraph{Package lists.}

The package list is simply a list of RPM file names (one per line). Be
sure to include all prerequisites that any packages you might add.
You do not need to specify the version, architecture, or extension of
the RPM filename.  For example, \file{bash-2.05-8.i386.rpm} need only
be listed as ``\file{bash}''.

\subparagraph{Custom kernels.}

If you want to use a customized kernel, you can add it to the image
after it is built. Follow these steps:

\begin{discuss}
  Is much of this section now moot, and we can simply refer the user
  to the package-specific notes for \rpmname{kernel-picker} (i.e.,
  Section~\ref{app:kernel-picker-overview},
  page~\pageref{app:kernel-picker-overview})?
\end{discuss}

\begin{enumerate}
\item Copy the kernel and associated files (\file{System.map},
  \file{module-info}, etc.) into the directory:

  \vspace{11pt}
  \centerline{\file{/var/lib/systemimager/images/<imagename>/boot}}

\item Edit the \file{systemconfig.conf} file in the following
  directory:

  \vspace{11pt}
  \centerline{\file{/var/lib/systemimager/images/<imagename>/etc/systemconfig/}}
  \vspace{11pt}
  
  Change the \emph{PATH} parameter in the \emph{[KERNEL0]} stanza to
  match your new kernel's filename.

\item When the clients are installed, they will copy over and boot
  your new kernel.
\end{enumerate}

Note that there is no \file{lilo.conf} file in the image. That file is
created by System Configurator from the contents of the
\file{systemconfigurator.conf} file. See the \file{systemconfig.conf}
man page for full details on the contents of this file.

\subparagraph{Build the Image.}

Once you are satisfied with the input, click the \button{Build Image}
button.  When the image completes, a popup window will appear
indicating whether the build succeeded or failed.  If successful,
click the \button{Ok} button, and you will be returned to the main
OSCAR wizard menu.

If the build fails, look through the console output\footnote{Note that
  all console output is also spooled into the file
  \file{oscarinstall.log}.} for some indication as to what happened to
cause the failure.  Common causes include: prerequisite failure, ran
out of disk space, and missing package files.  Also see the Release
Notes for this version of OSCAR in Section~\ref{sec:release-notes}
(page~\pageref{sec:release-notes}).


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsubsection{Step 3: Define your client machines} 
\label{det:defclients}

Press the Step 3 button of the wizard entitled \button{Define OSCAR
  Clients}. In the dialog box that is displayed, enter the appropriate
information. Again the defaults will be correct in most cases. At a
minimum, you will need to enter a value in the \field{Number of Hosts}
to specifies how many clients you want to create.

\begin{enumerate}
  
\item The \field{Image Name} field should specify the image name that
  was used to create the image in Step 2.
  
\item The \field{Domain Name} field should be used to specify the
  client's IP domain name.  
%
  It should contain the server node's domain (if it has one); if the
  server does not have a domain name, the default name
  \hostname{oscardomain} will be put in the field (although you may
  change it).
%
  This field \emph{must} have a value -- it cannot be blank.
%
  Note that especially for compute nodes on a private network, the
  domain name does not necessarily matter much.  The domain name
  supplied in this field is used to form the fully-qualified name of
  each host in the OSCAR cluster.  For example:
  \hostname{oscarnode1.oscardomain},
  \hostname{oscarnode2.oscardomain}, etc.  If your compute nodes are
  on a public network, you may want to use the ``real'' domain name
  that is part of their fully-qualified domain names.

\item The \field{Base name} field is used to specify the first part of
  the client name and hostname. It will have an index appended to the
  end of it. This name \emph{cannot} contain an underscore 
  character "\_".

\item The \field{Number of Hosts} field specifies how many clients to
  create.  {\bf This number must be greater than 0.}
  
\item The \field{Starting Number} specifies the index to append to the
  \field{Base Name} to derive the first client name. It will be
  incremented for each subsequent client.

\item The \field{Starting IP} specifies the IP address of the first
  client. It will be incremented for each subsequent client.  See
  Footnote~\ref{foot:private-ip-ranges} on
  page~\pageref{foot:private-ip-ranges} for more information on how to
  pick a starting IP address.
  
\item The \field{Subnet Mask} specifies the IP netmask for all
  clients.  See Footnote~\ref{foot:netmask} on
  page~\pageref{foot:netmask} for more information on how to select a
  netmask for your cluster.
  
\item The \field{Default Gateway} specifies the default route for all
  clients.

\end{enumerate}
  
When finished entering information, press the \button{Addclients} button.
A sample dialog is shown in Figure~\ref{fig:detailed-define-clients}. 

After the clients are created, a dialog will pop up with the
completion status. After closing that, you may press the
\button{Close} button in the build clients dialoge and continue with
the next step.

\begin{figure}[htbp]
  \begin{center}
    \includegraphics{figs/5a_sbs-define-clients1.\figext}
    \caption{Define the Clients.}
    \label{fig:detailed-define-clients}
  \end{center}
\end{figure}
    
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsubsection{Step 4: Collect client MAC addresses and Setup Networking} 
\label{det:setupnetwork}

The MAC address of a client is a twelve hex-digit hardware address
embedded in the client's ethernet adapter. MAC addresses look like,
``{\tt 00:0A:CC:01:02:03}'', as opposed to the familiar format of IP
addresses. These MAC addresses uniquely identify client machines on a
network before they are assigned IP addresses. DHCP uses the MAC
address to assign IP addresses to the clients.

In order to collect the MAC addresses, press the Step 4 button of the
wizard entitled \button{Setup Networking}. The OSCAR network utility
dialog box will be displayed.  To use this tool, you will need to know
how to network boot your client nodes.  For instructions on doing so,
see Appendix~\ref{app:net-boot-client-nodes}. A sample dialog is shown
in Figure~\ref{fig:detailed-collect-mac}.

To start the collection, press the \button{Collect MAC Address} button
and then network boot the first client.  As the clients boot up, their
MAC addresses will show up in the left hand window. Select a MAC
address and the appropriate client in the right side window. Click
\button{Assign MAC to Node} to associate that MAC address with that
node. If you would like to make specific nodes associated with
specific client definitions, you should boot them one at a time. If
you do not care which node gets associated with which client, you may
boot them all at once and randomly assign the MAC addresses.

When you have collected all of the MAC addresses, click the
\button{Stop Collecting} button and then click the \button{Configure
  DHCP Server} button to configure the DHCP server.
 
You may also configure your remote boot method from this panel. The
\button{Build Autoinstall Floppy} button will build a boot floppy for
client nodes that do not support PXE booting. The \button{Setup
  Network Boot} button will configure the server to answer PXE boot
requests if your client hardware supports it. See
Appendix~\ref{app:net-boot-client-nodes} for more details.  

When you have collected the addresses for all your client nodes and
completed the networks setup, press the \button{Close} button.

\begin{figure}[htbp]
  \begin{center}
    \includegraphics{figs/6e_sbs-found-mac.\figext}
    \caption{Collect client MAC addresses.}
    \label{fig:detailed-collect-mac}
  \end{center}
\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Client Installations}
\label{det:clientinstall}

During this phase, you will network boot your client nodes and they
will automatically be installed and configured as specified in
Section~\ref{sec:detailed-cluster-def} above. For a detailed
explanation of what happens during client installation, see
Appendix~\ref{app:client-install}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsubsection{Network boot the client nodes}

See Appendix~\ref{app:net-boot-client-nodes} for instructions on
network booting clients.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsubsection{Check completion status of nodes}
\label{det:clientfinish}

After several minutes, the clients should complete the installation.
You can watch the client consoles to monitor the progress. Depending
on the Post Installation Action you selected when building the image,
the clients will either halt, reboot, or beep incessantly when the
installation is completed.

The time required for installation depends on the capabilities of your
server, your clients, your network, and the number of simultaneous
client installations.  Generally, it should complete within several
minutes.
  
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsubsection{Reboot the client nodes}

After confirming that a client has completed its installation, you
should reboot the node from its hard drive. If you chose to have your
clients reboot after installation, they will do this on their
own. If the clients are not set to reboot, you must manually
reboot them. The filesystems will have been unmounted so it is safe
to simply reset or power cycle them.

\msg{Note: If you had to change the BIOS boot order on the client to
  do a network boot before booting from the local disk, you will need
  to reset the order to prevent the node from trying to do another
  network install.}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Cluster Configuration}

During this phase, the server and clients will be configured to work
together as a cluster.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsubsection{Step 5: Complete the cluster configuration}
\label{det:completeinstall}

{\bf Ensure that all client nodes have fully booted before proceeding
  with this step.}

Press the Step 5 button of the wizard entitled \button{Complete
  Cluster Setup}.  This will run the final installation configurations
scripts from each OSCAR software package, and perform various cleanup
and re-initialization functions.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsubsection{Step 6: Test your cluster using the OSCAR Cluster Test
  software}
\label{det:testcluster}
            
{\bf Ensure that all client nodes have fully booted before proceeding
  with this step.}

A simplistic test suite is provided in OSCAR to ensure that the key
cluster components (OpenSSH, PBS, MPI, PVM, etc.) are functioning
properly.

Press the Step 6 button of the wizard entitled \button{Test Cluster
  Setup}. This will open a window that will prompt you for the number
clients and number of processors per client. The system's basic
services are checked and then a set of user level tests are run. A
sample dialog is shown in Figure~\ref{fig:detailed-setup-test}. If any
of the test fail, then there may be problem with your installation.

\begin{figure}[htbp]
  \begin{center}
    \includegraphics{figs/8_test-cluster-complete.\figext}
    \caption{Setup cluster tests}
    \label{fig:detailed-setup-test}
  \end{center}
\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Congratulations!}

Your cluster setup is now complete. Your cluster nodes should
be ready for work.

Be sure to read Section~\ref{sec:pkg-specific-notes} (starting on
page~\pageref{sec:pkg-specific-notes}) -- it contains vital system
administrator-level information on several of the individual packages
that were installed as part of OSCAR.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Adding and Deleting client nodes}

This section describes the steps need when it becomes necessary to add
or delete client nodes. If you have already built your cluster
successfully and would like to add or delete a client node, execute
the following from the top-level OSCAR directory:

\begin{verbatim}
  # ./install_cluster <device>
\end{verbatim}

Like before, you must substitute the device name (e.g., \file{eth1})
for the server node's internal ethernet adapter in the above command.
See Section~\ref{det:installcluster}
(page~\pageref{det:installcluster}). Once the OSCAR wizard appears,
you are ready to add or delete clients. Note that these steps will
reuse the existing images made with the initial install, however, it
will extend or contract the set of defined clients in the cluster.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsubsection{Adding OSCAR clients}
\label{det:adding-clients}

Press the button of the wizard entitled \button{Add OSCAR Clients}. A
sample dialog is shown in Figure~\ref{fig:detailed-add-node}. These
steps should seem familiar -- they are same as steps 3, 4 and 5 of the
initial install. Refer to Sections~\ref{det:defclients},
\ref{det:setupnetwork}, and \ref{det:completeinstall}.

\begin{figure}[htbp]
  \begin{center}
    \includegraphics{figs/9a_sbs-add-node.\figext}
    \caption{Adding OSCAR clients.}
    \label{fig:detailed-add-node}
  \end{center}
\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsubsection{Deleting clients}
\label{det:deleting-clients}

Press the button of the wizard entitled \button{Delete OSCAR Clients}.
A sample dialog is shown in Figure~\ref{fig:detailed-delete-node}.
Select the node(s) that you wish to delete and press the button
\button{Delete clients}, then press \button{Close}.

\begin{figure}[htbp]
  \begin{center}
    \includegraphics{figs/10a_sbs-del-node.\figext}
    \caption{Deleting Oscar clients.}
    \label{fig:detailed-delete-node}
  \end{center}
\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Starting over -- installing OSCAR again}

If you feel that you want to start the cluster installation process
over from scratch in order to recover from irresolvable errors, you
can do so with the \cmd{start\_over} script located in the
\file{scripts} subdirectory.

It is important to note that \cmd{start\_over} is {\em not} an
uninstaller.  That is, \cmd{start\_over} does {\em not} guarantee to
return the head node to the state that it was in before OSCAR was
installed.  It does a ``best attempt'' to do so, but the only
guarantee that it provides is that the head node will be suitable for
OSCAR re-installation.  For example, the RedHat 7.x series ships with
a LAM/MPI RPM.  The OSCAR install process removes this RedHat-default
RPM and installs a custom OSCAR-ized LAM/MPI RPM.  The
\cmd{start\_over} script only removes the OSCAR-ized LAM/MPI RPM -- it
does not re-install the RedHat-default LAM/MPI RPI.

Another important fact to note is that because of the environment
manipulation that was performed via \cmd{switcher} from the previous
OSCAR install, {\em it is necessary to re-install OSCAR from a shell
  that was not tainted by the previous OSCAR installation}.
Specifically, the \cmd{start\_over} script can remove most files and
packages that were installed by OSCAR, but it cannot chase down and
patch up any currently-running user environments that were tainted by
the OSCAR environment manipulation packages.

Ensuring to have an untainted environment can be done in one of two
ways:

\begin{enumerate}
\item After running \cmd{start\_over}, completely logout and log back
  in again before re-installing.  {\em Simply launching a new shell
    may not be sufficient} (e.g., if the parent environment was
  tainted by the previous OSCAR install).  This will completely erase
  the previous OSCAR installation's effect on the environment in all
  user shells, and establish a set of new, untainted user
  environments.
  
\item Use a shell that was established {\em before} the previous OSCAR
  installation was established.  Although perhaps not entirely
  intuitive, this may include the shell was that initially used to
  install the previous OSCAR installation.
\end{enumerate}

Note that the logout/login method is {\em strongly} encouraged, as it
may be difficult to otherwise absolutely guarantee that a given
shell/window has an untainted environment.

% LocalWords:  Exp
