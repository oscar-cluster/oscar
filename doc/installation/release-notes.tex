% -*- latex -*-
%
% Copyright (c) 2002 The Trustees of Indiana University.
%                    All rights reserved.
%
% This file is part of the OSCAR software package.  For license
% information, see the COPYING file in the top level directory of the
% OSCAR source distribution.
%
% $Id: release-notes.tex,v 1.44 2003/11/26 23:53:35 bernardli Exp $
%

\section{Release Notes}
\label{sec:release-notes}

The following release notes apply to OSCAR version \oscarversion.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Release Features}
\label{subsec:release-features}

\begin{itemize}

\item Red Hat Linux 9, Fedora Core 2 and Mandrakelinux 10.0 support on x86.
\item Red Hat Enterprise Linux (RHEL) 3 support on Itanium and x86.
\item New RPM dependency finder helps build the server (DepMan/PackMan).
\item Ganglia now included in the default package set.
\item Torque now included/OpenPBS is now an optional package.
\item Multiple bug fixes and Wizard improvements.
\item Updated user interface (updated/improved wizard).

\end{itemize}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Notes for All Systems}
\label{subsec:release-notes}

\begin{itemize}

\item There is currently a known issue with the Delete Nodes functionality.
  You may notice error messages like the following when you delete the
  last node of a cluster:

  \begin{verbatim}
    /opt/oscar/packages/sis/scripts/post_clients: illegal or
    non-understood where string <nics.driver_module = >
    /opt/oscar/packages/sis/scripts/post_clients: INTERNAL
    ODA ERROR - failing to convert where expression
    <nics.driver_module = > in oda::delete_records - at
    least one record not deleted in table <nics> in database <oscar>
    /opt/oscar/packages/sis/scripts/post_clients: illegal or
    non-understood where string <nics.gateway = >
    /opt/oscar/packages/sis/scripts/post_clients: INTERNAL
    ODA ERROR - failing to convert where expression
    <nics.gateway = > in oda::delete_records - at least one
    record not deleted in table <nics> in database <oscar>
    /opt/oscar/packages/sis/scripts/post_clients: illegal or
    non-understood where string <nics.assignment_method = >
  \end{verbatim}

  This is not `harmful' but will leave the ODA database inconsistent
  with the SIS database.  The information on network interfaces is
  currently not used therefore it is not really damaging to your
  installation.  This will be fixed in the next release.

\item In Step 8 \button{Test Cluster Setup}, some tests may fail for the first
  time but subsequent re-runs of this step will indicate that all the
  tests succeeded.  This is a known issue and will be fixed for the next
  release.

\item Each package in OSCAR has its own installation and release
  notes.  \detailed{See Section~\ref{sec:pkg-specific-notes} for
  additional release notes.} \quick{See the full Installation Guide
  for these notes.}

\item All nodes must have a hostname other than ``{\tt localhost}''
  that does not contain any underscores (``{\tt \_}'') or periods ``{\tt
  .}''.  Some distributions complicate this by putting a line such
  as as the following in /etc/hosts:
  \begin{verbatim}
    127.0.0.1   localhost.localdomain   localhost
    yourhostname.yourdomain    yourhostname
  \end{verbatim}
  If this occurs the file should be separated as follows:
  \begin{verbatim}
  127.0.0.1 localhost.localdomain localhost
  192.168.0.1 yourhostname.yourdomain yourhostname
  \end{verbatim}

\item A domain name must be specified for the client nodes when
  defining them.

%TJN: KEEP THIS (if we keep the python2-compat rpms under c3?)
\item Due to some distribution portability issues, OSCAR currently installs
  a ``compatibility''  (\file{python2\--compat\--1.0-1}) RPM to resolve the
  Python2 prerequisite that is slightly different across different Linux
  distributions.  Also see the file \file{packages/c3/RPMS/NOTE.python2}.

\item In some cases, the test window that is opened from the
  OSCAR wizard may close suddenly when there is a test failure. If
  this happens, run the test script, \file{testing/test\_cluster},
  manually in a shell window to diagnose the problem.

\item Although OSCAR can be installed on pre-existing server nodes, it
  is typically easiest to use a machine that has a new, fresh install

  of a distribution listed in Table~\ref{tab:oscar-distro-support}
  {\em with no updates installed}.  If the updates are installed,
  there may be conflicts in RPM requirements.  It is recommended to
  install RedHat updates {\em after} the initial OSCAR installation has
  completed.  On the Mandrake systems the security updates must be added
  prior to the install.

\item The following benign warning messages will appear multiple times
  during the OSCAR installation process:

\begin{verbatim}
  rsync_stub_dir: no such variable at ...

  Use of uninitialized value in pattern match (m//) at
  /usr/lib/perl5/site_perl/oda.pm ...
\end{verbatim}
\endchange

  It is safe to ignore these messages.

\item The OSCAR installer will install the MySQL package on the server
  node if it is not already installed.  A random password will be automatically

  generated for the oscar user to access the oscar database.  This
  password will be stored in the file \file{/etc/odapw}.  It should
  not be needed by other users.
\endchange

\item The OSCAR installer GUI provides little protection for user
  mistakes.  If the user executes steps out of order, or provides
  erroneous input, Bad Things may happen.  Users are strongly
  encouraged to closely follow the instructions provided in this
  document.

\item The OSCAR installer GUI currently does not support deleting a
  node and adding the same node back {\em in the same session}.  If
  you wish to delete a node and then add it back, you must delete the
  node, close the OSCAR installer GUI, launch the OSCAR installer GUI
  again, and then add the node.

% This bug has been fixed
%\item During the \button{Build OSCAR Client Image} step, the ``Successfully
%  created image'' notice will appear even though the status bar looks
%  incomplete.  This incomplete status bar can be ignored.


\item If \cmd{ssh} produces warnings when logging into the compute
  nodes from the OSCAR head node, the C3 tools (e.g., \cmd{cexec}) may
  experience difficulties.  For example, if you use \cmd{ssh} to login
  in to the OSCAR head node from a terminal that does not support X
  windows and then try to run \cmd{cexec}, you might see a warning
  message in the \cmd{cexec} output:

\begin{verbatim}
  Warning: No xauth data; using fake authentication data for
  X11 forwarding.
\end{verbatim}

  Although this is only a warning message from \cmd{ssh}, \cmd{cexec}
  may interpret it as a fatal error, and not run across all cluster
  nodes properly (e.g., the \button{Install/Uninstall Packages} button
  will likely not work properly).

  Note that this is actually an \cmd{ssh} problem, not a C3 problem.
  As such, you need to eliminate any warning messages from ssh (more
  specifically, eliminate any output from \file{stderr}).  In the
  example above, you can tell the C3 tools to use the ``\cmd{-x}''
  switch to \cmd{ssh} in order to disable X forwarding:

\begin{verbatim}
  # export C3_RSH='ssh -x'
  # cexec uptime
\end{verbatim}

  The warnings about \cmd{xauth} should no longer appear (and the
  \button{Install/Uninstall Packages} button should work properly).

\item The \button{Cancel} button in the \button{Install/Uninstall
    Package} step does not work properly; if any packages are selected
  to be installed or uninstalled, clicking the \button{Cancel} button
  still triggers the execution of the package installer/uninstaller.
  This will be fixed in a future release.  The same behavior occurs if
  you close the window via the window manager's ``close''
  functionality.

  Note that if you do not select any additional packages to
  install/uninstall, nothing will run (as expected).

\item The SIS multicast facility (Flamethrower) is ``experimentally''
  supported.  If you are having problems with multicast and would like
  to experiment please check the {\tt oscar-users} and/or
  {\tt sisuite-users} mailing lists for tips.

% BLI: This bug has been fixed
%\item If you downloaded PBS through Step 0 \button{Download Addtional
%  OSCAR Packages}, but did not select it for installation, you will get
%  error messages complaining about conflicts. The way around this is to goto
%  \file{/tftpboot/rpm} and remove all the OpenPBS RPMs. If you want to install
%  PBS instead of Torque, select it in Step 1 \button{Select OSCAR Packages To
%  Install}, then either copy the OpenPBS RPMs back to
%  \file{/tftpboot/rpm} or just re-run the OSCAR wizard and the RPMs will be
%  automatically copied back.



\end{itemize}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Red Hat 9 Notes}
\label{subsec:rh90notes}

There are a few issues that may crop up when using OSCAR on Red Hat 9.
The following items highlight these issues.

\begin{itemize}

\item Deselecting Pfilter causes the image creation to fail.  This is
  due to a dependency with IPtables and when Pfilter is not selected
  the IPtables RPM is not listed in the node (image) rpmlist.   The simple
  fix is to add ``iptables'' to the Red Hat 9 rpmlist if you are not
  installing Pfilter on the compute nodes.

\item The RPM system has been updated with this Red Hat release.  The
 OSCAR install process will likely display several warnings due to unsigned
 RPMS.  These warnings can be ignored.

%TJN: These are the notes Jeff posted for the "Re: mksiimage hang problems"
%  thread on oscar-devel (2003-07-23)
\item In some OSCAR pre-release testing, RPM would hang during the
  building of a client image (Section~\ref{det:build-client-image}).
  This is a documented bug in the version of RPM that ships with
  Redhat 9; it is not a problem with OSCAR.  The procedure
  that was used to remedy this situation is outlined below (excerpts
  taken from \url{http://www.rpm.org/hintskinks/repairdb-2003-06/}):
        \begin{itemize}
        \item If RPM hangs at any point (e.g., building the client
          image) -- first ensure that it really has hung and just
          isn't taking a long, long time to complete.  Typical
          indications that it has genuinely hung include: the disk is
          not running and load goes down to 0 (or nearly 0) and stays
          there.

        \item Then do a \cmd{ps} and find the PID of the \cmd{rpm}
          process:
\begin{verbatim}
  # ps -eadf | grep rpm | grep -v grep
  ...output...
  # kill <PID_of_RPM>
\end{verbatim}

        \item This will probably not kill the process (it's likely to
          be in a state where it is ignoring signals), but it should
          be tried anyway -- this would allow \cmd{rpm} to exit
          cleanly.  If \cmd{rpm} does exit cleanly, jump down to the
          last step in this procedure.

        \item If \cmd{rpm} does not exit within a short period of
          time, \cmd{kill -9 <PID\_of\_RPM>}.  This guarantees that
          \cmd{rpm} will not exit cleanly, but in this case, it's ok.
          Now, do the following:
                        \begin{enumerate}
                        \item Save a copy of the RPM database (just to
                          be safe):
\begin{verbatim}
  # cd /var/lib
  # tar zcvf /tmp/rpmdb.tar.gz rpm
\end{verbatim}

                        \item Delete any existing RPM database locks:
\begin{verbatim}
  # cd /var/lib/rpm
  # rm -f __db*
\end{verbatim}

                        \item Rebuild the RPM database:
\begin{verbatim}
  # rpm -vv --rebuilddb
\end{verbatim}
                        \end{enumerate}

                      \item Now re-run the OSCAR step that hung.  If
                        RPM hangs again, repeat these steps to un-hang
                        it.  Testing has shown that it may be
                        necessary to repeat these steps multiple times
                        in order to get a successful RPM run.
        \end{itemize}

\end{itemize}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Fedora Core 2 Notes}
\label{subsec:fc2notes}

\begin{itemize}

\item SIS currently does not fully support 2.6 kernel, the way we make it
  work right now is to run a script which generate \file{/etc/modprobe.conf}
  from \file{/etc/modules.conf} - this does not work 100\% of the time.  If
  you can deploy an image to your client nodes but are having problems
  booting, chances are this is the issue.  To get around this problem, copy a
  working \file{modprobe.conf} for your client nodes to the image directory
  \file{/var\-/lib\-/systemimager\-/images\-/oscarimage\-/etc/}.  Re-image the
  nodes and it should work.  One quick way of getting the correct
  \file{modprobe.conf} is to boot a node with the Fedora Core 2 CD 1
  and run the Rescue mode.  You will then be able to find
  \file{modprobe.conf} in \-/tmp.

\end{itemize}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% jlm - removed this section seeing as how there is no drake support
% in 4.0
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%\subsection{Mandrake 9.0 Notes}
%\label{subsec:mdk90notes}
%
%The following may need to be run before attempting to install OSCAR on a
%Mandrake 9.0 cluster.  If there are problems during the server preparation
%related to C3 or Python2 this may solve the issue.
%
%\begin{itemize}
%\item Install the Python 2 compatibility RPM.  This RPM can be found
%  in the OSCAR distribution package, under the \file{packages/c3/RPMS}
%  directory:
%
%\begin{verbatim}
%  # cd oscar-2.3/packages/c3/RPMS
%  # rpm -Uvh python2-compat-1.0-1.noarch.rpm
%\end{verbatim}
%
% (ORIGINALLY in the 8.2 notes)
% TJN: Doc fix for BUG#686916 'xterm needed by SIS'
%      Remove after 2.3 when add to server_prep/pre-req check areas.
%     - on RH7.x systems the xterm binaray is packaged w/ XFree86 (big bundle)
%     - on MDK8.x it showed up in it's own xterm rpm.
%$\item The OSCAR wizard makes use of \cmd{xterm} so this package must be installed.  You can check the RPM database for this package by typing
%  \cmd{rpm -q xterm}.  If \cmd{xterm} is not available, you must
%  install the \file{xterm-165-3mdk.i586.rpm} RPM (you may need Mandrake
%  CD's to run the \cmd{urpmi} command as mentioned above):
%
%\begin{verbatim}
%  # urpmi xterm
%\end{verbatim}
%
% TJN: relates to server_prep: unmunge_pathenv()
%\item Lastly, \user{root}'s default shell configuration files hardcode the
%  value for the {\tt PATH} environment variable, regardless of what is
%  added via {\tt profile.d/} startup scripts.  This effects various
%  OSCAR installed components, which are installed into locations such
%  as \file{/opt}.  As such, the OSCAR installer appends the global path,
%  e.g., {\tt \$PATH} or {\tt \$\{PATH\}} depending on the shell, to the end
%  of the path so OSCAR installed applications are in the search
%  environment.  This potentially makes changes to the following files:
%
%  \begin{itemize}
%  \item \file{/root/.bashrc}
%  \item \file{/root/.cshrc}
%  \item \file{/root/.tcshrc}
%  \end{itemize}
%
%\end{itemize}
%
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Red Hat Enterprise Linux 3 (AS) Notes}
\label{subsec:ia64notes}

Note: These instructions are for Red Hat Enterprise Linux 3 (Update 3); see
Step 2 if you are using the Gold or Update 2 versions.

\begin{itemize}

\item mysql-server

\emph{BEFORE YOU BEGIN}: you will need to obtain a mysql-server RPM and put it into

  \file{/tftpboot/rpm}

The easiest way is to get the SRPM and rebuild it,

\begin{verbatim}
  rpmbuild --rebuild mysql-3.23.58-1.src.rpm
  cp /usr/src/redhat/RPMS/ia64/mysql-server-3.23.58-1.ia64.rpm /tftpboot/rpm
\end{verbatim}

MySQL v3.23.58-1 is the version that came with Red Hat Enterprise Linux 3, Update 3; if you cannot
find that particular version, please make sure that you copy all the
rebuilt MySQL RPMs (including the server RPM).  For example, if the
version you found is v3.23.58-2.3:

\begin{verbatim}
  rpmbuild --rebuild mysql-3.23.58-2.3.src.rpm
  cp /usr/src/redhat/RPMS/ia64/mysql*-3.23.58-2.3.ia64.rpm /tftpboot/rpm
\end{verbatim}

Note: The key here is to keep the MySQL versions consistent.


\item Red Hat Enterprise Linux 3 (Gold or Update 2) rpmlist

\emph{IN OSCAR WIZARD STEP 4}: if you're running an earlier version than Update 3, you will
need to manually select the correct rpmlist before generating the client image.
Select the appropriate file for your architecture

  \file{/opt/oscar/oscarsample/redhat-3asU2-i386.rpmlist}
  \ \\  % Force newline
or
  \ \\  % Force newline
  \file{/opt/oscar/oscarsample/redhat-3asU2-ia64.rpmlist}


\item Initrd and \file{elilo.conf}

\emph{AFTER OSCAR WIZARD STEP 4}: there is a problem generating a valid initrd on the
nodes, so we must provide one in the image.  Copy a valid initrd to image
directory

  \file{/var/lib/systemimager/images/oscarimage/boot/efi/EFI/redhat}

with the commands

\begin{verbatim}
  cp /boot/efi/efi/redhat/initrd-*.img \
    /var/lib/systemimager/images/oscarimage/boot/efi/EFI/redhat/

  cp /boot/efi/efi/redhat/elilo.conf \
    /var/lib/systemimager/images/oscarimage/boot/efi/EFI/redhat/
\end{verbatim}


\item \file{systemconfig.conf}

\emph{AFTER OSCAR WIZARD STEP 4}: you will need to add an INITRD entry to the image
file

  \file{/var/lib/systemimager/images/oscarimage/etc/systemconfig/systemconfig.conf}

After the modification, the kernel section should look like this:

\begin{verbatim}
  [KERNEL0]
    PATH = /boot/efi//EFI/redhat/vmlinuz-2.4.21-20.EL
    INITRD = /boot/efi//EFI/redhat/initrd-2.4.21-20.EL.img
    LABEL = 2.4.21-20.EL
\end{verbatim}

where 2.4.21-20.EL is the kernel for Red Hat Enterprise Linux 3 (Update 3)
you should substitute your kernel version if you're not running Update 3.

{\bf Note: Note carefully the \emph{DOUBLE SLASH} in the PATH and INITRD lines!}


\item SCSI and network

\emph{AFTER OSCAR WIZARD STEP 4}: you may also need to add a Hardware section with
SCSI and network drivers.  In the image file

  \file{/var/lib/systemimager/images/oscarimage/etc/systemconfig/systemconfig.conf}

For an Intel SR870BH2, the hardware section of this file would look like:

\begin{verbatim}
  [HARDWARE]
    ORDER = e1000 e1000 mptscsih mptbase scsi_mod
\end{verbatim}


\item USB

\emph{AFTER OSCAR WIZARD STEP 4}: if you need to use the keyboard on a USB-only
system, like the Intel SR870BH2, you need to add the USB controller to the
image file

  \file{/var/lib/systemimager/images/oscarimage/etc/modules.conf}

For example,

\begin{verbatim}
  echo alias usb-controller usb-uhci >> \
    /var/lib/systemimager/images/oscarimage/etc/modules.conf
\end{verbatim}


\item \file{tftp-server}

\emph{AFTER OSCAR WIZARD STEP 6, BEFORE YOU BOOT THE CLIENT NODES}: you will need to
replace the TFTP server.  If your distrubition doesn't come with a tftp-server
package you should download and install the appropriate file from a repository.

Once you have downloaded and copied it to a known directory you must install
the package and turn it on:

\begin{verbatim}
  rpm -i tftp-server-0.32-4.ia64.rpm
\end{verbatim}

(it could be "ia64" or "i386", depending of your machine's architecture).

\begin{verbatim}
  /sbin/chkconfig --level 345 tftp on
\end{verbatim}


\item DISKORDER

\emph{AFTER OSCAR WIZARD STEP 6, BEFORE YOU BOOT THE CLIENT NODES}: you may have to
modify the DISKORDER sequence used by SystemImager to prevent the system from
using your CD-ROM as a disk, resulting in a "Kernel panic" during the
client's installation phase.  Add the following to the SystemImager
kernel command line:

\begin{verbatim}
  DISKORDER=sd,hd,cciss,ida,rd
\end{verbatim}

For i386 clients, add this value to the "APPEND" keyword in the "KERNEL"
section of

  \file{/tftpboot/pxelinux.cfg/default}

For example,

\begin{verbatim}
  DEFAULT systemimager
  LABEL systemimager
  DISPLAY message.txt
  PROMPT 1
  TIMEOUT 50
  KERNEL kernel
    APPEND vga=extended initrd=initrd.img root=/dev/ram \
      DISKORDER=sd,hd,cciss,ida,rd
\end{verbatim}

For ia64 clients, add this value to the "append" keyword in the "image"
section of

  \file{/tftpboot/elilo.conf}

For example,

\begin{verbatim}
  prompt
  timeout=50
  default=sisboot

  image=kernel
    label=sisboot
    initrd=initrd.img
    read-only
    root=/dev/ram
    append="DISKORDER=sd,hd,cciss,ida,rd"
\end{verbatim}

NOTE: elilo requires keywords in lower case.

\end{itemize}

%jlm - commented this out
%IA64 support was removed for the \oscarversion\ release of OSCAR due to
%timing problems and the significant differences between current IA32
%distributions and the freely available IA64 distributions.  IA64 support is
%fully expected to return in the next release.
%
%TJN: Uncomment when ia64 support returns (and update things!) ;)
%
% \begin{itemize}
%
% \item The OSCAR auto-install diskette will probably not work on Itanium
%   systems, but they mostly have support for network booting.
%
% \item Some Itanium 1 or 2 systems are supported by OSCAR under
%   RedHat's Linux 7.2 release for Itanium.  Itanium systems that can
%   use the standard RedHat Itanium kernel for booting and network
%   access should work with OSCAR.
%
% \item Itanium 2 machines often have newer hardware interfaces for
%       things like networking or disk drives that sometimes require newer
%       kernels than those provided by official Linux distributions. RedHat 7.2
%       will work on some Itanium2 machines. Manufacturers will typically
%       provide driver disks or driver downloads for their machine's newer
%       hardware interfaces. The user will sometimes have to compile their own
%       kernel.  This is essentially a ``do it yourself'' kind
%     of process, and not recommended for novices.  Please consult the
%     OSCAR user's mailing list for more information.
%
% \item If an Itanium (or an IA32 based) system has new or unknown
%   hardware that is not supported by the stock kernel in the base
%   operating system release, it will not work with standard OSCAR,
%   since OSCAR uses the kernel RPMS supplied with the vendors release
%   to boot and load the compute nodes.  If you have a custom compiled
%   kernel/module set that works for your hardware, you should look at
%   the NCSA Kernel\_Picker utility at \url{http://oscar.ncsa.uiuc.edu/} to
%   enable you to use them in OSCAR.
%
% \end{itemize}
%

% LocalWords:  tex Exp TJN unmunge pathenv
